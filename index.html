<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Damages & Shortages Claim Form</title>
    <!-- Link to Google Fonts for 'Inter' -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- Embedded CSS -->
    <style>
        /* General body styles */
        body {
            font-family: 'Inter', sans-serif; /* Using Inter font as per guidelines */
            background-color: #f4f5f7; /* Light grey background */
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Align content to the top */
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box; /* Include padding in element's total width and height */
        }

        /* Main container for the form */
        .container {
            background-color: #fff; /* White background for the form */
            border-radius: 12px; /* Rounded corners for the container */
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1); /* Enhanced shadow for depth */
            width: 100%;
            max-width: 800px; /* Max width for larger screens */
            padding: 30px 40px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
        }

        /* Header styles */
        header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 1px solid #eee; /* Separator line */
            padding-bottom: 20px;
        }

        header h1 {
            font-size: 28px;
            color: #333;
            margin-bottom: 5px;
            font-weight: 700;
        }

        header .company-name {
            font-size: 16px;
            color: #666;
            margin-top: 0;
        }

        /* Progress bar styling */
        .progress-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            position: relative;
            padding: 0 20px; /* Adjust padding to give space for the first/last circles */
        }

        /* Horizontal line for the progress bar */
        .progress-bar::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 2px;
            background-color: #e0e0e0; /* Grey line */
            transform: translateY(-50%);
            z-index: 0; /* Ensure line is behind circles */
        }

        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 1; /* Ensure circles are above the line */
            color: #999; /* Default text color for steps */
            font-size: 14px;
            flex: 1; /* Distribute space evenly */
            text-align: center;
        }

        .step .circle {
            width: 34px; /* Slightly larger circles */
            height: 34px;
            border-radius: 50%;
            background-color: #e0e0e0; /* Grey circle for inactive steps */
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: 700;
            margin-bottom: 8px;
            transition: background-color 0.3s ease, color 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); /* Small shadow for circles */
        }

        /* Active step styling */
        .step.active .circle {
            background-color: #5b7da8; /* Blue color from the image */
            color: #fff;
        }

        .step.active span {
            color: #333; /* Darker text for active step */
            font-weight: 700;
        }

        /* Generic class for form sections to manage display */
        .form-section {
            display: none; /* Hidden by default */
            padding: 20px;
            border-top: 1px solid #eee;
            margin-top: 20px;
            text-align: left; /* Align text to left */
            flex-grow: 1; /* Allow section to take available vertical space */
            justify-content: space-between; /* Space out content and button */
            flex-direction: column; /* Ensure content and button are stacked */
        }

        /* Content area styling (for the initial screen) */
        .content {
            text-align: center;
            flex-grow: 1; /* Allow content to take available vertical space */
            display: flex; /* Keep as flex to manage inner layout */
            flex-direction: column;
            justify-content: space-between; /* Space out content and button */
        }

        .content p {
            font-size: 16px;
            line-height: 1.6;
            color: #555;
            margin-bottom: 20px;
        }

        .policy-link {
            color: #5b7da8; /* Blue color for the link */
            text-decoration: none;
            font-weight: 500;
            transition: color 0.2s ease;
        }

        .policy-link:hover {
            text-decoration: underline;
            color: #4a6a90; /* Slightly darker blue on hover */
        }

        /* Logo styling */
        .logo {
            margin: 40px auto; /* Center the logo and add vertical spacing */
            width: fit-content; /* Ensure the div only takes the width of the image */
        }

        .logo img {
            max-width: 250px; /* Adjust max-width as needed for your logo */
            height: auto;
            display: block; /* Remove extra space below image */
            border-radius: 8px; /* Rounded corners for the logo */
        }

        /* Button styling */
        .button-group {
            display: flex;
            justify-content: center;
            gap: 20px; /* Space between buttons */
            margin-top: 30px;
        }

        .continue-button, .next-button, .submit-button, .back-button {
            background-color: #5b7da8; /* Blue color from the image */
            color: #fff;
            border: none;
            padding: 14px 35px; /* Larger padding for a more prominent button */
            border-radius: 8px; /* Rounded corners for the button */
            font-size: 18px; /* Slightly larger font size */
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease, box-shadow 0.2s ease;
            font-weight: 500;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15); /* Shadow for button */
            width: auto; /* Allow button to size based on content */
            flex-shrink: 0; /* Prevent buttons from shrinking in button-group */
        }

        .back-button {
            background-color: #6c757d; /* Grey for back button */
        }

        .continue-button:hover, .next-button:hover, .submit-button:hover {
            background-color: #4a6a90; /* Slightly darker blue on hover */
            transform: translateY(-2px); /* Slight lift effect */
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
        }

        .back-button:hover {
            background-color: #5a6268; /* Slightly darker grey on hover */
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
        }

        .continue-button:active, .next-button:active, .submit-button:active, .back-button:active {
            transform: translateY(0); /* Press down effect */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        /* Custom Modal Styles (for alert replacement) */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1000; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            width: 90%;
            max-width: 400px;
            text-align: center;
            position: relative;
            animation: fadeIn 0.3s ease-out; /* Simple fade-in animation */
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .close-button {
            color: #aaa;
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close-button:hover,
        .close-button:focus {
            color: #333;
            text-decoration: none;
        }

        #modalMessage {
            font-size: 1.1em;
            color: #333;
            margin-bottom: 25px;
        }

        #modalOkButton {
            background-color: #5b7da8;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s ease;
        }

        #modalOkButton:hover {
            background-color: #4a6a90;
        }

        /* Styles for the new Claim Type Selection Modal */
        #claimTypeModal .modal-content {
            max-width: 450px; /* Slightly wider for the options */
            padding: 40px;
        }

        #claimTypeModal h2 {
            font-size: 24px;
            color: #333;
            margin-bottom: 25px;
        }

        .claim-options {
            display: flex;
            flex-direction: column;
            gap: 15px; /* Space between radio options */
            margin-bottom: 30px;
            text-align: left; /* Align radio buttons to the left */
        }

        .claim-option {
            display: flex;
            align-items: center;
            background-color: #f0f4f7; /* Light background for options */
            padding: 15px 20px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            cursor: pointer;
            transition: background-color 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
        }

        .claim-option:hover {
            background-color: #e6edf2;
            border-color: #a7c1dd;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .claim-option input[type="radio"] {
            margin-right: 15px;
            transform: scale(1.3); /* Larger radio buttons */
            accent-color: #5b7da8; /* Blue accent color */
        }

        .claim-option label {
            font-size: 18px;
            color: #333;
            cursor: pointer;
            font-weight: 500;
        }

        .confirm-claim-button {
            background-color: #5b7da8;
            color: #fff;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 17px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease, box-shadow 0.2s ease;
            font-weight: 500;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
        }

        .confirm-claim-button:hover {
            background-color: #4a6a90;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
        }

        .confirm-claim-button:active {
            transform: translateY(0);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        /* Styles for the Damages & Shortage Terms & Conditions sections */
        #damagesTermsSection, #shortageTermsSection, #customerSection, #documentsSection, #disclaimerSection {
            text-align: left; /* Text alignment for these sections */
        }

        #damagesTermsSection h2, #shortageTermsSection h2, #customerSection h2, #documentsSection h2, #disclaimerSection h2 {
            text-align: center;
            color: #333;
            margin-bottom: 25px;
            font-size: 24px;
        }

        #damagesTermsSection ul, #shortageTermsSection ul {
            list-style: decimal; /* Numbered list */
            padding-left: 25px; /* Indent list items */
            margin-bottom: 25px;
            color: #555;
            line-height: 1.8;
        }

        #damagesTermsSection ul li, #shortageTermsSection ul li {
            margin-bottom: 10px;
        }

        #damagesTermsSection .important-note, #shortageTermsSection .important-note {
            font-weight: 500;
            color: #cc0000; /* Red color for emphasis */
            margin-top: 30px;
            text-align: center;
            line-height: 1.5;
        }

        .terms-acceptance {
            display: flex;
            align-items: center;
            justify-content: center; /* Center the checkbox and label */
            margin: 30px 0;
            font-size: 17px;
            color: #333;
        }

        .terms-acceptance input[type="checkbox"] {
            margin-right: 10px;
            transform: scale(1.4); /* Make checkbox larger */
            accent-color: #5b7da8; /* Blue accent color */
        }

        .terms-acceptance label {
            cursor: pointer;
        }

        /* Styles for Customer Section */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
            font-size: 16px;
        }

        .form-group input[type="text"],
        .form-group input[type="number"],
        .form-group input[type="file"],
        .form-group textarea { /* Added textarea */
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 16px;
            box-sizing: border-box; /* Include padding in width */
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        .form-group input[type="text"]:focus,
        .form-group input[type="number"]:focus,
        .form-group input[type="file"]:focus,
        .form-group textarea:focus { /* Added textarea */
            border-color: #5b7da8;
            box-shadow: 0 0 0 3px rgba(91, 125, 168, 0.2);
            outline: none;
        }

        .error-message {
            color: #e74c3c; /* Red color for error messages */
            font-size: 14px;
            margin-top: 5px;
            display: block; /* Ensures it takes its own line */
            text-align: left;
        }

        /* Styles for Documents Section (general) */
        #documentsSection .file-upload-area {
            border: 2px dashed #ccc;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            margin-bottom: 20px;
            cursor: pointer;
            transition: border-color 0.2s ease, background-color 0.2s ease;
        }

        #documentsSection .file-upload-area:hover {
            border-color: #5b7da8;
            background-color: #f0f4f7;
        }

        #documentsSection .file-upload-area p {
            color: #666;
            font-size: 16px;
            margin: 0;
            margin-bottom: 10px;
        }

        #documentsSection .file-upload-area input[type="file"] {
            display: none; /* Hide the default file input button */
        }

        #documentsSection .file-list {
            list-style: none;
            padding: 0;
            margin: 0;
            border: 1px solid #eee;
            border-radius: 8px;
            max-height: 200px; /* Scrollable list if many files */
            overflow-y: auto;
            margin-bottom: 20px;
        }

        #documentsSection .file-list li {
            padding: 10px 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 15px;
            color: #444;
        }

        #documentsSection .file-list li:last-child {
            border-bottom: none;
        }

        #documentsSection .file-list .remove-file {
            background: none;
            border: none;
            color: #e74c3c;
            font-size: 20px;
            cursor: pointer;
            padding: 0 5px;
            transition: color 0.2s ease;
        }

        #documentsSection .file-list .remove-file:hover {
            color: #c0392b;
        }

        /* Note at the top of the documents section */
        #documentsSection .submission-note {
            font-size: 15px;
            color: #555;
            margin-bottom: 20px;
            padding: 10px 15px;
            background-color: #eaf2fa; /* Light blue background for the note */
            border-left: 4px solid #5b7da8; /* Blue accent border */
            border-radius: 4px;
            font-weight: 500;
        }

        #documentsSection .submission-note strong {
            color: #333;
        }

        /* Specific content for Damages and Shortage documents */
        .document-content-type {
            display: none; /* Hidden by default */
            margin-top: 20px;
        }

        .document-content-type h3 {
            text-align: center;
            font-size: 20px;
            color: #444;
            margin-bottom: 20px;
        }

        /* Styles for attachment notes */
        .attachment-guidance-note { /* Renamed for clarity */
            font-size: 14px;
            color: #777;
            margin-bottom: 15px;
            text-align: center;
            line-height: 1.4;
        }

        /* Styles for Disclaimer Section */
        #disclaimerSection p {
            font-size: 16px;
            line-height: 1.6;
            color: #555;
            margin-bottom: 20px;
            text-align: center;
        }

        #disclaimerSection strong {
            color: #333;
        }

        /* Styles for Review Modal */
        #reviewModal .modal-content {
            max-width: 600px;
            text-align: left;
        }

        #reviewModal h2 {
            text-align: center;
            margin-bottom: 25px;
        }

        #reviewSummaryContent {
            background-color: #f8f8f8;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #eee;
            margin-bottom: 30px;
            max-height: 400px;
            overflow-y: auto;
        }

        #reviewSummaryContent p {
            margin-bottom: 10px;
            font-size: 15px;
            color: #444;
            line-height: 1.5;
        }

        #reviewSummaryContent strong {
            color: #333;
            display: inline-block; /* Allows strong to take space */
            min-width: 150px; /* Align content if labels are short */
        }

        #reviewSummaryContent ul {
            list-style: none;
            padding: 0;
            margin-top: 5px;
            font-size: 14px;
            color: #666;
        }

        #reviewSummaryContent ul li {
            margin-bottom: 5px;
            padding-left: 10px;
            position: relative;
        }

        #reviewSummaryContent ul li::before {
            content: '•';
            color: #5b7da8;
            font-weight: bold;
            display: inline-block;
            width: 1em;
            margin-left: -1em;
        }

        .review-button-group {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }

        /* Styles for the final submission options modal */
        #submissionOptionsModal .modal-content {
            max-width: 450px;
        }
        #submissionOptionsModal .modal-content h2 {
            margin-bottom: 20px;
        }
        #submissionOptionsModal .modal-content .button-group {
            flex-direction: column;
            gap: 15px;
        }
        #submissionOptionsModal .modal-content .button-group button {
            width: 100%;
        }


        /* Responsive adjustments */
        @media (max-width: 768px) {
            .container {
                padding: 20px 25px;
            }

            header h1 {
                font-size: 24px;
            }

            .progress-bar {
                flex-wrap: wrap; /* Allow steps to wrap on smaller screens */
                justify-content: center;
                padding: 0; /* Remove padding to maximize space for wrapped steps */
                margin-bottom: 20px; /* Reduce margin for tighter layout */
            }

            .progress-bar::before {
                display: none; /* Hide the single connecting line on smaller screens */
            }

            .step {
                width: 33%; /* 3 steps per row */
                margin-bottom: 15px; /* Add margin between wrapped rows */
            }

            .step .circle {
                margin-bottom: 5px; /* Less margin for tighter spacing */
            }

            #claimTypeModal .modal-content {
                padding: 30px;
            }
            #claimTypeModal h2 {
                font-size: 20px;
            }
            .claim-option label {
                font-size: 16px;
            }

            #damagesTermsSection ul, #shortageTermsSection ul, #customerSection ul, #documentsSection ul, #disclaimerSection ul {
                padding-left: 20px;
            }
            .button-group {
                flex-direction: column;
                gap: 10px;
            }
            .continue-button, .next-button, .submit-button, .back-button {
                width: 100%;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }
            header h1 {
                font-size: 20px;
            }
            .step {
                width: 50%; /* 2 steps per row on very small screens */
            }
            .content p {
                font-size: 15px;
            }
            .continue-button, .next-button, .submit-button, .back-button {
                padding: 12px 30px;
                font-size: 16px;
            }
            #claimTypeModal .modal-content {
                padding: 20px;
            }
            .claim-option {
                padding: 12px 15px;
            }
            .claim-option label {
                font-size: 15px;
            }
            #damagesTermsSection ul, #shortageTermsSection ul, #customerSection ul, #documentsSection ul, #disclaimerSection ul {
                padding-left: 15px;
            }
             #reviewSummaryContent strong {
                min-width: 100px; /* Adjust for smaller screens */
            }
        }
    </style>
</head>
<body>
    <!-- Main container for the entire form page -->
    <div class="container">
        <!-- Header section of the form -->
        <header>
            <h1>Damages & Shortages Claim Form</h1>
            <p class="company-name">Gerhards Importers Canada</p>
        </header>

        <!-- Navigation/Progress bar section -->
        <nav class="progress-bar">
            <!-- Step 1: Policy (Active state) -->
            <div class="step active">
                <div class="circle">1</div>
                <span>Policy</span>
            </div>
            <!-- Step 2: Claim Type -->
            <div class="step">
                <div class="circle">2</div>
                <span>Claim Type</span>
            </div>
            <!-- Step 3: Terms/Conditions -->
            <div class="step">
                <div class="circle">3</div>
                <span>Terms/Conditions</span>
            </div>
            <!-- Step 4: Customer -->
            <div class="step">
                <div class="circle">4</div>
                <span>Customer</span>
            </div>
            <!-- Step 5: Documents -->
            <div class="step">
                <div class="circle">5</div>
                <span>Documents</span>
            </div>
            <!-- Step 6: Disclaimer -->
            <div class="step">
                <div class="circle">6</div>
                <span>Disclaimer</span>
            </div>
        </nav>

        <!-- IMPORTANT: Wrap all your form sections inside a <form> tag -->
        <!-- We are relying on Netlify's built-in form handling, so data-netlify="true" is needed. -->
        <form name="claim_form" method="POST" data-netlify="true" id="mainClaimForm" data-netlify-honeypot="bot-field">
            <!-- Netlify requires a hidden input for every form -->
            <input type="hidden" name="form-name" value="claim_form" />
            <!-- Honeypot field (hidden from users, but bots might fill it) -->
            <input type="hidden" name="bot-field" />

            <!-- Initial content area, initially visible -->
            <main id="initialContentSection" class="content form-section" style="display: block;">
                <p>At Gerhards Importers Canada, we strive to provide the best possible service to our customers, and ensuring the safe delivery of your orders is of utmost importance to us. While we make every effort to pack and ship your items securely, occasionally, damages or missing items can occur during transit.</p>
                <p>Refer to our <a href="https://gerhardscanada.sharepoint.com/:b:/s/PublicSharing/EY4yUu4ede5PoDaHoo2YleAB1C3s-Zxo3OpgSJpN8g_QyQ?e=tKFQPR" class="policy-link" id="policyLink" target="_blank">Damages and Shortages Policy here.</a></p>
                
                <!-- Logo section -->
                <div class="logo">
                    <img src="logo.jpg" alt="Gerhards Importers Canada Logo">
                </div>

                <!-- Continue button (type="button" to prevent early submission) -->
                <button type="button" class="continue-button" id="continueButton">Continue</button>
            </main>

            <!-- Section for Damages Terms & Conditions, initially hidden -->
            <section id="damagesTermsSection" class="form-section">
                <h2>Terms and Conditions for Damages Claim</h2>
                <p>To ensure the full credit for your claim, the following items must be submitted.</p>
                <p>Failure to provide any of these within the specified timeframe will result in a reduced credit amount:</p>
                <ul>
                    <li>A copy of the driver's Proof of Delivery (POD), with any damages clearly noted.</li>
                    <li>Photographic or video evidence of the damages.</li>
                    <li>An accurate count of the damages per product, including brand and description.</li>
                    <li>Submission of all required documentation within 3 business days of the delivery date.</li>
                </ul>
                <p class="important-note">Please ensure all information is accurate and provided on time to avoid any reduction in credit.</p>
                
                <div class="terms-acceptance">
                    <input type="checkbox" id="acceptDamagesTerms" name="acceptDamagesTerms">
                    <label for="acceptDamagesTerms">I accept the terms and conditions for Damages Claim.</label>
                </div>
                <div class="button-group">
                    <button type="button" class="back-button" id="backButtonDamagesTerms">Back</button>
                    <button type="button" class="next-button" id="nextButtonDamagesTerms">Next</button>
                </div>
            </section>

            <!-- New Section for Shortage Terms & Conditions, initially hidden -->
            <section id="shortageTermsSection" class="form-section">
                <h2>Terms and Conditions for Shortage Claim</h2>
                <p>To ensure the full credit for your claim, the following items must be submitted.</p>
                <p>Failure to provide any of these within the specified timeframe will result in a reduced credit amount:</p>
                <ul>
                    <li>A copy of the driver's Proof of Delivery (POD), with any shortage clearly noted.</li>
                    <li>An accurate count of the missing per product, including brand and description.</li>
                    <li>Submission of all required documentation within 3 business days of the delivery date.</li>
                </ul>
                <p class="important-note">Please ensure all information is accurate and provided on time to avoid any reduction in credit.</p>
                
                <div class="terms-acceptance">
                    <input type="checkbox" id="acceptShortageTerms" name="acceptShortageTerms">
                    <label for="acceptShortageTerms">I accept the terms and conditions for Shortage Claim.</label>
                </div>
                <div class="button-group">
                    <button type="button" class="back-button" id="backButtonShortageTerms">Back</button>
                    <button type="button" class="next-button" id="nextButtonShortageTerms">Next</button>
                </div>
            </section>

            <!-- New Section for Customer Information, initially hidden -->
            <section id="customerSection" class="form-section">
                <h2>Customer Information</h2>
                <div class="form-group">
                    <label for="customerName">Customer Name:</label>
                    <input type="text" id="customerName" name="customerName" required>
                    <span class="error-message" id="customerNameError"></span>
                </div>
                <div class="form-group">
                    <label for="packingSlipNumber">Packing Slip Number (5 digits):</label>
                    <input type="number" id="packingSlipNumber" name="packingSlipNumber" required pattern="[0-9]{5}" inputmode="numeric" maxlength="5">
                    <span class="error-message" id="packingSlipNumberError"></span>
                </div>
                <div class="button-group">
                    <button type="button" class="back-button" id="backButtonCustomer">Back</button>
                    <button type="button" class="next-button" id="nextButtonCustomer">Next</button>
                </div>
            </section>

            <!-- New Section for Documents, initially hidden -->
            <section id="documentsSection" class="form-section">
                <h2>Attach Supporting Documents</h2>
                <p class="submission-note">
                    Please submit the following information <strong>within 3 business days</strong> to receive 100% credit: 
                </p>

                <!-- Content for Shortage Claim Documents (initially hidden) -->
                <div id="shortageDocumentsContent" class="document-content-type">
                    <p class="attachment-guidance-note">
                        Proof of Delivery (POD) attachments are recommended.
                    </p>
                    <div class="form-group">
                        <label for="missingCountShortage">Accurate count of the missing CASES per product/brand/description:</label>
                        <textarea id="missingCountShortage" name="missingCountShortage" rows="4" required placeholder="e.g., 5 cases of Product X - Brand A, 2 cases of Product Y - Brand B"></textarea>
                        <span class="error-message" id="missingCountShortageError"></span>
                    </div>
                    <!-- File upload area for Shortage Claim -->
                    <div class="file-upload-area" id="shortageFileUploadArea">
                        <!-- Renamed file input name to a unique one for Netlify Forms -->
                        <input type="file" id="shortageFileInput" name="shortage_attachedFiles[]" multiple accept=".pdf,image/jpeg,image/png,image/gif,video/mp4,video/webm,video/ogg">
                        <p>Drag & Drop your files here or click to browse</p>
                        <button type="button" class="next-button" style="margin-top: 10px;">Browse Files</button>
                    </div>
                    <ul class="file-list" id="shortageFileList">
                        <!-- Uploaded files will be listed here -->
                    </ul>
                    <span class="error-message" id="shortageFileUploadError"></span>
                </div>

                <!-- Content for Damages Claim Documents (initially hidden) -->
                <div id="damagesDocumentsContent" class="document-content-type">
                    <p class="attachment-guidance-note">
                        Proof of Delivery (POD) and Damages images attachments are recommended.
                    </p>
                    <div class="form-group">
                        <label for="damageCountDamages">Accurate count of the damages per product/brand/description (in units):</label>
                        <textarea id="damageCountDamages" name="damageCountDamages" rows="4" required placeholder="e.g., 10 units of Product X - Brand A (broken bottles), 3 units of Product Y - Brand B (dented cans)"></textarea>
                        <span class="error-message" id="damageCountDamagesError"></span>
                    </div>
                    <!-- File upload area for Damages Claim -->
                    <div class="file-upload-area" id="damagesFileUploadArea">
                        <!-- Renamed file input name to a unique one for Netlify Forms -->
                        <input type="file" id="damagesFileInput" name="damages_attachedFiles[]" multiple accept=".pdf,image/jpeg,image/png,image/gif,video/mp4,video/webm,video/ogg">
                        <p>Drag & Drop your files here or click to browse</p>
                        <button type="button" class="next-button" style="margin-top: 10px;">Browse Files</button>
                    </div>
                    <ul class="file-list" id="damagesFileList">
                        <!-- Uploaded files will be listed here -->
                    </ul>
                    <span class="error-message" id="damagesFileUploadError"></span>
                </div>

                <div class="button-group">
                    <button type="button" class="back-button" id="backButtonDocuments">Back</button>
                    <button type="button" class="next-button" id="nextButtonDocuments">Next</button>
                </div>
            </section>

            <!-- New Section for Disclaimer, initially hidden -->
            <section id="disclaimerSection" class="form-section">
                <h2>Disclaimer</h2>
                <p>
                    The absence of ANY of the required supporting documentation for your claim, or if the claim was submitted AFTER the 3rd business day following the delivery date, the credited amount will be reduced accordingly.
                </p>
                <p>
                    Please ensure that all necessary documents are provided to avoid further adjustments.
                </p>
                <div class="button-group">
                    <button type="button" class="back-button" id="backButtonDisclaimer">Back</button>
                    <!-- IMPORTANT: Changed to type="submit" so the form submits to Netlify Forms -->
                    <button type="submit" class="submit-button" id="submitButtonDisclaimer">Submit</button> 
                </div>
            </section>
        </form>


        <!-- Custom modal for general alerts -->
        <div id="customModal" class="modal">
            <div class="modal-content">
                <span class="close-button" id="generalModalClose">&times;</span>
                <p id="modalMessage"></p>
                <button type="button" id="modalOkButton">OK</button>
            </div>
        </div>

        <!-- New Modal for Claim Type Selection -->
        <div id="claimTypeModal" class="modal">
            <div class="modal-content">
                <span class="close-button" id="claimTypeModalClose">&times;</span>
                <h2>Select Claim Type</h2>
                <div class="claim-options">
                    <label class="claim-option">
                        <input type="radio" name="claimType" value="Damages Claim" checked>
                        <span>Damages Claim</span>
                    </label>
                    <label class="claim-option">
                        <input type="radio" name="claimType" value="Shortage Claim">
                        <span>Shortage Claim</span>
                    </label>
                </div>
                <button type="button" class="confirm-claim-button" id="confirmClaimSelection">Confirm Selection</button>
            </div>
        </div>

        <!-- New Modal for Reviewing Data -->
        <div id="reviewModal" class="modal">
            <div class="modal-content">
                <span class="close-button" id="reviewModalClose">&times;</span>
                <h2>Review Your Claim Data</h2>
                <div id="reviewSummaryContent">
                    <!-- Summary content will be injected here by JavaScript -->
                </div>
                <div class="review-button-group">
                    <button type="button" class="back-button" id="reviewModalBack">Back to edit again</button>
                    <!-- IMPORTANT: Changed to type="button" as the actual submit will be handled by the form's natural submission -->
                    <button type="button" class="next-button" id="reviewModalSubmit">OK to finish/process</button> 
                </div>
            </div>
        </div>

        <!-- New Modal for Submission Options (after final submission) -->
        <div id="submissionOptionsModal" class="modal">
            <div class="modal-content">
                <h2>Claim Submitted Successfully!</h2>
                <p>What would you like to do next?</p>
                <div class="button-group">
                    <button type="button" class="next-button" id="enterAnotherClaimButton">Enter another claim</button>
                    <button type="button" class="back-button" id="closeFormButton">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Embedded JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const continueButton = document.getElementById('continueButton');
            const policyLink = document.getElementById('policyLink');
            
            // General custom modal elements
            const customModal = document.getElementById('customModal');
            const modalMessage = document.getElementById('modalMessage');
            const generalModalCloseButton = document.getElementById('generalModalClose');
            const modalOkButton = document.getElementById('modalOkButton');

            // Claim Type Selection Modal elements
            const claimTypeModal = document.getElementById('claimTypeModal');
            const claimTypeModalCloseButton = document.getElementById('claimTypeModalClose');
            const confirmClaimSelectionButton = document.getElementById('confirmClaimSelection');
            const claimTypeRadios = document.querySelectorAll('input[name="claimType"]'); 

            // Form sections
            const mainClaimForm = document.getElementById('mainClaimForm'); // Reference to the main form
            const initialContentSection = document.getElementById('initialContentSection');
            const damagesTermsSection = document.getElementById('damagesTermsSection');
            const shortageTermsSection = document.getElementById('shortageTermsSection');
            const customerSection = document.getElementById('customerSection');
            const documentsSection = document.getElementById('documentsSection'); 
            const disclaimerSection = document.getElementById('disclaimerSection'); 

            // Elements for Damages Terms & Conditions
            const acceptDamagesTermsCheckbox = document.getElementById('acceptDamagesTerms');
            const nextButtonDamagesTerms = document.getElementById('nextButtonDamagesTerms');
            const backButtonDamagesTerms = document.getElementById('backButtonDamagesTerms');

            // Elements for Shortage Terms & Conditions
            const acceptShortageTermsCheckbox = document.getElementById('acceptShortageTerms');
            const nextButtonShortageTerms = document.getElementById('nextButtonShortageTerms');
            const backButtonShortageTerms = document.getElementById('backButtonShortageTerms');

            // Elements for Customer Section
            const customerNameInput = document.getElementById('customerName');
            const packingSlipNumberInput = document.getElementById('packingSlipNumber');
            const customerNameError = document.getElementById('customerNameError');
            const packingSlipNumberError = document.getElementById('packingSlipNumberError');
            const nextButtonCustomer = document.getElementById('nextButtonCustomer');
            const backButtonCustomer = document.getElementById('backButtonCustomer');

            // Elements for Documents Section (conditional content)
            const shortageDocumentsContent = document.getElementById('shortageDocumentsContent');
            const damageCountDamagesInput = document.getElementById('damageCountDamages');
            const damageCountDamagesError = document.getElementById('damageCountDamagesError');

            const damagesDocumentsContent = document.getElementById('damagesDocumentsContent');
            const missingCountShortageInput = document.getElementById('missingCountShortage');
            const missingCountShortageError = document.getElementById('missingCountShortageError');

            // File upload elements (general, but managed by specific sections)
            const shortageFileUploadArea = document.getElementById('shortageFileUploadArea');
            const shortageFileInput = document.getElementById('shortageFileInput');
            const shortageFileList = document.getElementById('shortageFileList');
            const shortageFileUploadError = document.getElementById('shortageFileUploadError');
            
            const damagesFileUploadArea = document.getElementById('damagesFileUploadArea');
            const damagesFileInput = document.getElementById('damagesFileInput');
            const damagesFileList = document.getElementById('damagesFileList');
            const damagesFileUploadError = document.getElementById('damagesFileUploadError');


            const nextButtonDocuments = document.getElementById('nextButtonDocuments');
            const backButtonDocuments = document.getElementById('backButtonDocuments');

            // Elements for Disclaimer Section
            const backButtonDisclaimer = document.getElementById('backButtonDisclaimer');
            const submitButtonDisclaimer = document.getElementById('submitButtonDisclaimer');

            // Elements for Review Modal
            const reviewModal = document.getElementById('reviewModal');
            const reviewModalCloseButton = document.getElementById('reviewModalClose');
            const reviewSummaryContent = document.getElementById('reviewSummaryContent');
            const reviewModalBack = document.getElementById('reviewModalBack');
            const reviewModalSubmit = document.getElementById('reviewModalSubmit');

            // Elements for Submission Options Modal
            const submissionOptionsModal = document.getElementById('submissionOptionsModal');
            const enterAnotherClaimButton = document.getElementById('enterAnotherClaimButton');
            const closeFormButton = document.getElementById('closeFormButton');


            // Array to store selected files (NOT USED for actual submission in this rollback, 
            // but kept for UI list management. Files are now submitted via the form's native behavior)
            let attachedShortageFiles = [];
            let attachedDamagesFiles = [];
            let currentClaimType = ''; // To store the selected claim type globally

            const progressSteps = document.querySelectorAll('.progress-bar .step');

            /**
             * Updates the active step in the progress bar.
             * @param {number} stepNumber - The 1-based index of the step to set as active.
             */
            function updateProgressBar(stepNumber) {
                progressSteps.forEach((step, index) => {
                    if (index + 1 === stepNumber) {
                        step.classList.add('active');
                    } else {
                        step.classList.remove('active');
                    }
                });
            }

            /**
             * Shows a custom modal with a given message.
             * @param {string} message - The message to display in the modal.
             * @param {HTMLElement} modalElement - The specific modal element to show (e.g., customModal or claimTypeModal).
             */
            function showCustomModal(message, modalElement) {
                if (modalElement === customModal) {
                    modalMessage.textContent = message;
                }
                modalElement.style.display = 'flex'; // Use flex to center
            }

            /**
             * Hides a specific custom modal.
             * @param {HTMLElement} modalElement - The specific modal element to hide.
             */
            function hideCustomModal(modalElement) {
                modalElement.style.display = 'none';
            }

            /**
             * Hides all content sections and modals to prepare for showing a new one.
             */
            function hideAllSectionsAndModals() {
                initialContentSection.style.display = 'none';
                damagesTermsSection.style.display = 'none';
                shortageTermsSection.style.display = 'none';
                customerSection.style.display = 'none';
                documentsSection.style.display = 'none'; 
                disclaimerSection.style.display = 'none'; 
                customModal.style.display = 'none';
                claimTypeModal.style.display = 'none';
                reviewModal.style.display = 'none'; 
                submissionOptionsModal.style.display = 'none'; 
                // Also hide specific document content divs
                shortageDocumentsContent.style.display = 'none';
                damagesDocumentsContent.style.display = 'none';
            }

            /**
             * Resets the entire form to its initial state.
             */
            function resetForm() {
                hideAllSectionsAndModals();
                initialContentSection.style.display = 'block'; // Show initial section
                updateProgressBar(1); // Reset progress bar to Policy

                // Clear all form fields
                mainClaimForm.reset(); // Resets all form elements to their initial values
                
                // Manually reset file inputs, as form.reset() might not clear FileList
                damagesFileInput.value = ''; 
                shortageFileInput.value = '';

                // Reset stored file arrays and re-render lists
                attachedShortageFiles = [];
                attachedDamagesFiles = [];
                renderAttachedFiles(attachedDamagesFiles, damagesFileList, damagesFileUploadError);
                renderAttachedFiles(attachedShortageFiles, shortageFileList, shortageFileUploadError);

                // Reset error messages
                customerNameError.textContent = '';
                packingSlipNumberError.textContent = '';
                damageCountDamagesError.textContent = '';
                missingCountShortageError.textContent = '';
                damagesFileUploadError.textContent = '';
                shortageFileUploadError.textContent = '';

                // Reset global claim type tracker
                currentClaimType = ''; 

                // Ensure 'Damages Claim' radio is checked by default again if it was initially
                if (claimTypeRadios.length > 0) {
                    claimTypeRadios[0].checked = true;
                }
                console.log('Form reset to initial state.');
            }


            // Event listener for the Continue button click
            if (continueButton) {
                continueButton.addEventListener('click', () => {
                    console.log('Continue button clicked, showing claim type selection.');
                    showCustomModal('', claimTypeModal); // Show the new claim type selection modal
                });
            }

            // Event listener for the Policy link click
            if (policyLink) {
                policyLink.addEventListener('click', (event) => {
                    console.log('Policy link clicked, opening in new tab.');
                    // The link itself handles navigation with target="_blank"
                });
            }

            // Event listeners to close the general custom modal
            if (generalModalCloseButton) {
                generalModalCloseButton.addEventListener('click', () => hideCustomModal(customModal));
            }
            if (modalOkButton) {
                modalOkButton.addEventListener('click', () => hideCustomModal(customModal));
            }

            // Event listeners to close the claim type selection modal
            if (claimTypeModalCloseButton) {
                claimTypeModalCloseButton.addEventListener('click', () => hideCustomModal(claimTypeModal));
            }
            
            // Event listener for the review modal close button
            if (reviewModalCloseButton) {
                reviewModalCloseButton.addEventListener('click', () => hideCustomModal(reviewModal));
            }


            // Event listener for confirming claim type selection
            if (confirmClaimSelectionButton) {
                confirmClaimSelectionButton.addEventListener('click', () => {
                    let selectedClaimType = null;
                    for (const radio of claimTypeRadios) {
                        if (radio.checked) {
                            selectedClaimType = radio.value;
                            break;
                        }
                    }

                    if (selectedClaimType) {
                        currentClaimType = selectedClaimType; // Store selected type
                        hideCustomModal(claimTypeModal); // Hide the selection modal
                        hideAllSectionsAndModals(); // Hide all other sections

                        if (selectedClaimType === 'Damages Claim') {
                            console.log('Damages Claim selected. Showing Terms & Conditions.');
                            damagesTermsSection.style.display = 'block'; // Show damages terms section
                            updateProgressBar(3); // Update progress bar to "Terms/Conditions"
                        } else if (selectedClaimType === 'Shortage Claim') {
                            console.log('Shortage Claim selected. Showing Terms & Conditions.');
                            shortageTermsSection.style.display = 'block'; // Show shortage terms section
                            updateProgressBar(3); // Update progress bar to "Terms/Conditions"
                        }
                    } else {
                        showCustomModal('Please select a claim type to proceed.', customModal);
                    }
                });
            }

            // Event listener for the 'Next' button in Damages Terms & Conditions
            if (nextButtonDamagesTerms) {
                nextButtonDamagesTerms.addEventListener('click', () => {
                    if (acceptDamagesTermsCheckbox.checked) {
                        console.log('Damages Terms accepted. Proceeding to Customer section.');
                        hideAllSectionsAndModals(); // Hide current section
                        customerSection.style.display = 'block'; // Show customer section
                        updateProgressBar(4); // Update progress bar to "Customer"
                    } else {
                        showCustomModal('Please accept the terms and conditions to proceed.', customModal);
                    }
                });
            }

            // Event listener for the 'Next' button in Shortage Terms & Conditions
            if (nextButtonShortageTerms) {
                nextButtonShortageTerms.addEventListener('click', () => {
                    if (acceptShortageTermsCheckbox.checked) {
                        console.log('Shortage Terms accepted. Proceeding to Customer section.');
                        hideAllSectionsAndModals(); // Hide current section
                        customerSection.style.display = 'block'; // Show customer section
                        updateProgressBar(4); // Update progress bar to "Customer"
                    } else {
                        showCustomModal('Please accept the terms and conditions to proceed.', customModal);
                    }
                });
            }

            // Event listener for the 'Next' button in Customer section
            if (nextButtonCustomer) {
                nextButtonCustomer.addEventListener('click', () => {
                    let isValid = true;

                    // Validate Customer Name
                    if (customerNameInput.value.trim() === '') {
                        customerNameError.textContent = 'Customer Name is required.';
                        isValid = false;
                    } else {
                        customerNameError.textContent = '';
                    }

                    // Validate Packing Slip Number
                    const packingSlipValue = packingSlipNumberInput.value.trim();
                    if (packingSlipValue === '') {
                        packingSlipNumberError.textContent = 'Packing Slip Number is required.';
                        isValid = false;
                    } else if (!/^\d{5}$/.test(packingSlipValue)) { // Regex to check for exactly 5 digits
                        packingSlipNumberError.textContent = 'Packing Slip Number must be exactly 5 numeric digits.';
                        isValid = false;
                    } else {
                        packingSlipNumberError.textContent = '';
                    }

                    if (isValid) {
                        console.log('Customer information valid. Proceeding to Documents section.');
                        hideAllSectionsAndModals();
                        documentsSection.style.display = 'block'; // Show documents section
                        updateProgressBar(5); // Update progress bar to "Documents"
                        
                        // Show specific document content based on selected claim type
                        if (currentClaimType === 'Damages Claim') {
                            damagesDocumentsContent.style.display = 'block';
                            // Initial render for damages files
                            renderAttachedFiles(attachedDamagesFiles, damagesFileList, damagesFileUploadError);
                        } else if (currentClaimType === 'Shortage Claim') {
                            shortageDocumentsContent.style.display = 'block';
                            // Initial render for shortage files
                            renderAttachedFiles(attachedShortageFiles, shortageFileList, shortageFileUploadError);
                        }
                    } else {
                        showCustomModal('Please correct the errors in the customer information form.', customModal);
                    }
                });
            }

            // Add an input event listener to restrict packing slip number to 5 digits
            if (packingSlipNumberInput) {
                packingSlipNumberInput.addEventListener('input', (event) => {
                    // Get the current value
                    let value = event.target.value;
                    // Ensure it's a string and slice if longer than 5
                    if (value.length > 5) {
                        event.target.value = value.slice(0, 5);
                    }
                    // Clear error message instantly if user starts correcting
                    if (packingSlipNumberError.textContent && /^\d{5}$/.test(event.target.value)) {
                        packingSlipNumberError.textContent = '';
                    }
                });
            }

            // --- Documents Section Logic (Generalized for both claim types) ---

            /**
             * Attaches a click listener to a file upload area to trigger its associated file input.
             * @param {HTMLElement} uploadAreaElement - The div acting as the click area.
             * @param {HTMLElement} fileInputElement - The actual hidden file input.
             */
            function setupFileUploadArea(uploadAreaElement, fileInputElement) {
                if (uploadAreaElement && fileInputElement) {
                    uploadAreaElement.addEventListener('click', () => {
                        fileInputElement.click();
                    });
                }
            }

            // Setup for Damages File Upload
            setupFileUploadArea(damagesFileUploadArea, damagesFileInput);
            // Setup for Shortage File Upload
            setupFileUploadArea(shortageFileUploadArea, shortageFileInput);


            /**
             * Handles file selection for either damages or shortage files.
             * Files are *not* stored in attachedFiles array for submission via Netlify Forms,
             * but the array is used to manage the UI list. The actual file input handles submission.
             * @param {Event} event - The change event from the file input.
             * @param {Array<File>} targetFilesArray - The array to store the files (e.g., attachedDamagesFiles or attachedShortageFiles).
             * @param {HTMLElement} errorSpanElement - The span to display file-specific errors.
             */
            function handleFileSelection(event, targetFilesArray, errorSpanElement) {
                errorSpanElement.textContent = ''; // Clear previous errors
                const files = event.target.files;

                console.log(`Attempting to add ${files.length} files to UI list for ${currentClaimType} attachments.`); 
                
                if (files.length > 0) {
                    // Clear existing files in array and add new ones (since input.files is a new FileList each time)
                    targetFilesArray.length = 0; // Clear the array efficiently
                    for (let i = 0; i < files.length; i++) {
                        const file = files[i];
                        const fileType = file.type;

                        // Validate file type (PDF, image, video)
                        if (fileType.startsWith('image/') || fileType.startsWith('video/') || fileType === 'application/pdf') {
                             targetFilesArray.push(file); // Add to our array for UI management
                             console.log(`Added file to UI list: ${file.name}`); 
                        } else {
                            errorSpanElement.textContent = `File "${file.name}" is not a valid PDF, image, or video type.`;
                            showCustomModal(`File "${file.name}" is not a valid PDF, image, or video type. Only PDF, JPG, PNG, GIF, MP4, WebM, Ogg are allowed.`, customModal);
                            console.error(`Invalid file type rejected: ${file.name} (${fileType})`); 
                        }
                    }
                    // Pass current file list element based on currentClaimType
                    const currentFileListElement = currentClaimType === 'Damages Claim' ? damagesFileList : shortageFileList;
                    renderAttachedFiles(targetFilesArray, currentFileListElement, errorSpanElement); // Update the list displayed to the user
                } else {
                    console.log("No files selected."); 
                    targetFilesArray.length = 0; // Ensure array is cleared if no files are chosen
                    const currentFileListElement = currentClaimType === 'Damages Claim' ? damagesFileList : shortageFileList;
                    renderAttachedFiles(targetFilesArray, currentFileListElement, errorSpanElement);
                }
            }

            // Add change listeners for both file inputs
            if (damagesFileInput) {
                damagesFileInput.addEventListener('change', (event) => {
                    handleFileSelection(event, attachedDamagesFiles, damagesFileUploadError);
                });
            }
            if (shortageFileInput) {
                shortageFileInput.addEventListener('change', (event) => {
                    handleFileSelection(event, attachedShortageFiles, shortageFileUploadError);
                });
            }


            /**
             * Renders the list of attached files in the UI for a specific claim type.
             * @param {Array<File>} filesArray - The array of files to render.
             * @param {HTMLElement} fileListElement - The ul element to render files into.
             * @param {HTMLElement} errorSpanElement - The error message span for this file list.
             */
            function renderAttachedFiles(filesArray, fileListElement, errorSpanElement) {
                fileListElement.innerHTML = ''; // Clear current list
                if (filesArray.length === 0) {
                    const listItem = document.createElement('li');
                    listItem.textContent = 'No files attached yet.';
                    fileListElement.appendChild(listItem);
                    errorSpanElement.textContent = ''; // Attachments are not required now
                } else {
                    filesArray.forEach((file, index) => {
                        const listItem = document.createElement('li');
                        listItem.textContent = file.name;

                        // Add a remove button
                        const removeButton = document.createElement('button');
                        removeButton.textContent = '×'; // 'x' character for close
                        removeButton.classList.add('remove-file');
                        removeButton.title = `Remove ${file.name}`;
                        removeButton.addEventListener('click', (event) => {
                            event.stopPropagation(); // Prevent triggering the parent li click
                            removeFile(index, filesArray, fileListElement, errorSpanElement);
                        });
                        listItem.appendChild(removeButton);
                        fileListElement.appendChild(listItem);
                    });
                     errorSpanElement.textContent = ''; // Clear error if files are present
                }
                console.log(`Current ${currentClaimType} files in UI array:`, filesArray.map(f => f.name)); 
            }

            /**
             * Removes a file from the attachedFiles array and updates the UI for a specific claim type.
             * This DOES NOT clear the actual file input's selected files,
             * but since we're re-assigning input.files on change, it's fine for Netlify Forms.
             * @param {number} indexToRemove - The index of the file to remove.
             * @param {Array<File>} filesArray - The array from which to remove the file.
             * @param {HTMLElement} fileListElement - The ul element to re-render.
             * @param {HTMLElement} errorSpanElement - The error message span for this file list.
             */
            function removeFile(indexToRemove, filesArray, fileListElement, errorSpanElement) {
                filesArray.splice(indexToRemove, 1); // Remove from array
                renderAttachedFiles(filesArray, fileListElement, errorSpanElement); // Re-render the list
                console.log('File removed from UI list. Current files:', filesArray.map(f => f.name));
                // Note: The actual file input's FileList is immutable, this only affects our UI-tracking array.
                // For Netlify Forms, as long as the 'name' attribute is on the input, it handles it.
            }
            

            // Event listener for 'Next' button in Documents section
            if (nextButtonDocuments) {
                nextButtonDocuments.addEventListener('click', () => {
                    let isValid = true;
                    // Reset all document-related errors
                    damageCountDamagesError.textContent = '';
                    missingCountShortageError.textContent = '';
                    shortageFileUploadError.textContent = '';
                    damagesFileUploadError.textContent = '';


                    if (currentClaimType === 'Damages Claim') {
                        // Validate 'Accurate count of damages' textbox for Damages Claim
                        if (damageCountDamagesInput.value.trim() === '') {
                            damageCountDamagesError.textContent = 'Accurate count of damages is required.';
                            isValid = false;
                        }
                        // Attachments are NOT required now, so no file count validation here.
                    } else if (currentClaimType === 'Shortage Claim') {
                        // Validate 'Accurate count of missing CASES' textbox for Shortage Claim
                        if (missingCountShortageInput.value.trim() === '') {
                            missingCountShortageError.textContent = 'Accurate count of missing CASES is required.';
                            isValid = false;
                        }
                        // Attachments are NOT required now, so no file count validation here.
                    }

                    if (isValid) {
                        console.log('Documents information valid. Proceeding to Disclaimer section.');
                        hideAllSectionsAndModals();
                        disclaimerSection.style.display = 'block'; // Show disclaimer section
                        updateProgressBar(6); // Update progress bar to "Disclaimer"
                    } else {
                        showCustomModal('Please fill in all required text fields in the Documents section.', customModal);
                    }
                });
            }

            // --- Disclaimer Section Logic ---
            if (submitButtonDisclaimer) {
                submitButtonDisclaimer.addEventListener('click', (event) => {
                    // Prevent the default form submission for review
                    event.preventDefault(); 
                    console.log('Submit button clicked. Showing review modal.');
                    showReviewModal(); // Call function to show review summary
                });
            }

            /**
             * Gathers all entered data and displays it in the review modal.
             */
            function showReviewModal() {
                let summaryHtml = `
                    <h3>Claim Details:</h3>
                    <p><strong>Claim Type:</strong> ${currentClaimType}</p>
                    <p><strong>Customer Name:</strong> ${customerNameInput.value.trim()}</p>
                    <p><strong>Packing Slip Number:</strong> ${packingSlipNumberInput.value.trim()}</p>
                `;

                if (currentClaimType === 'Damages Claim') {
                    summaryHtml += `
                        <h3>Damages Details:</h3>
                        <p><strong>Accurate Count (Units):</strong> ${damageCountDamagesInput.value.trim()}</p>
                    `;
                    // Display files from the UI tracking array
                    if (attachedDamagesFiles.length > 0) {
                        summaryHtml += `<p><strong>Attached Damages Files:</strong></p><ul>`;
                        attachedDamagesFiles.forEach(file => {
                            summaryHtml += `<li>${file.name}</li>`;
                        });
                        summaryHtml += `</ul>`;
                    } else {
                        summaryHtml += `<p><strong>Attached Damages Files:</strong> None</p>`;
                    }
                } else if (currentClaimType === 'Shortage Claim') {
                    summaryHtml += `
                        <h3>Shortage Details:</h3>
                        <p><strong>Accurate Count (Cases):</strong> ${missingCountShortageInput.value.trim()}</p>
                    `;
                    // Display files from the UI tracking array
                    if (attachedShortageFiles.length > 0) {
                        summaryHtml += `<p><strong>Attached Shortage Files:</strong></p><ul>`;
                        attachedShortageFiles.forEach(file => {
                            summaryHtml += `<li>${file.name}</li>`;
                        });
                        summaryHtml += `</ul>`;
                    } else {
                        summaryHtml += `<p><strong>Attached Shortage Files:</strong> None</p>`;
                    }
                }

                reviewSummaryContent.innerHTML = summaryHtml;
                showCustomModal('', reviewModal); // Show the review modal
            }

            // Event listener for "OK to finish/process" in review modal
            if (reviewModalSubmit) {
                reviewModalSubmit.addEventListener('click', () => {
                    console.log('Final submission confirmed. Submitting form to Netlify Forms service.');
                    hideCustomModal(reviewModal); // Hide review modal
                    // The form's submit event is now triggered naturally
                    mainClaimForm.submit(); 
                    // Netlify will handle the redirection after submission based on form settings or default behavior.
                    // This often goes to a /thanks or /success page managed by Netlify.
                    // The submissionOptionsModal would then appear if the form has a custom success redirect.
                    // If not, Netlify handles default success page.
                });
            }

            // Event listener for "Back to edit again" in review modal
            if (reviewModalBack) {
                reviewModalBack.addEventListener('click', () => {
                    console.log('Returning to Documents section for editing.');
                    hideCustomModal(reviewModal); // Hide review modal
                    documentsSection.style.display = 'block'; // Go back to documents
                    updateProgressBar(5); // Update progress bar
                    // Re-display correct sub-section in documents
                    if (currentClaimType === 'Damages Claim') {
                        damagesDocumentsContent.style.display = 'block';
                    } else if (currentClaimType === 'Shortage Claim') {
                        shortageDocumentsContent.style.display = 'block';
                    }
                });
            }

            // --- Post-Submission Options Logic ---
            // These buttons are now shown after Netlify's default success page (if configured)
            // or if you handle a client-side redirect after success.
            // For this setup, we'll keep them wired to reset/redirect directly.
            if (enterAnotherClaimButton) {
                enterAnotherClaimButton.addEventListener('click', () => {
                    console.log('User chose to enter another claim. Resetting form.');
                    hideCustomModal(submissionOptionsModal); // Hide the modal first
                    resetForm(); // Reset the entire form
                });
            }

            if (closeFormButton) {
                closeFormButton.addEventListener('click', () => {
                    console.log('User chose to close the form. Redirecting to gerhardscanada.com');
                    window.location.href = 'https://www.gerhardscanada.com'; // Redirect to the specified URL
                });
            }


            // --- Back Button Logic ---

            // Back from Damages Terms to Claim Type Selection
            if (backButtonDamagesTerms) {
                backButtonDamagesTerms.addEventListener('click', () => {
                    console.log('Back from Damages Terms to Claim Type selection.');
                    hideAllSectionsAndModals();
                    showCustomModal('', claimTypeModal); // Show the claim type modal again
                    updateProgressBar(2); // Update progress bar to "Claim Type"
                });
            }

            // Back from Shortage Terms to Claim Type Selection
            if (backButtonShortageTerms) {
                backButtonShortageTerms.addEventListener('click', () => {
                    console.log('Back from Shortage Terms to Claim Type selection.');
                    hideAllSectionsAndModals();
                    showCustomModal('', claimTypeModal); // Show the claim type modal again
                    updateProgressBar(2); // Update progress bar to "Claim Type"
                });
            }

            // Back from Customer to previous Terms section
            if (backButtonCustomer) {
                backButtonCustomer.addEventListener('click', () => {
                    console.log('Back from Customer to Terms section.');
                    hideAllSectionsAndModals();
                    if (currentClaimType === 'Damages Claim') {
                        damagesTermsSection.style.display = 'block';
                    } else if (currentClaimType === 'Shortage Claim') {
                        shortageTermsSection.style.display = 'block';
                    }
                    updateProgressBar(3); // Update progress bar to "Terms/Conditions"
                });
            }

            // Back from Documents to Customer section
            if (backButtonDocuments) {
                backButtonDocuments.addEventListener('click', () => {
                    console.log('Back from Documents to Customer section.');
                    hideAllSectionsAndModals();
                    customerSection.style.display = 'block';
                    updateProgressBar(4); // Update progress bar to "Customer"
                });
            }

            // Back from Disclaimer to Documents section
            if (backButtonDisclaimer) {
                backButtonDisclaimer.addEventListener('click', () => {
                    console.log('Back from Disclaimer to Documents section.');
                    hideAllSectionsAndModals();
                    documentsSection.style.display = 'block';
                    updateProgressBar(5); // Update progress bar to "Documents"
                    // Re-display correct sub-section in documents
                    if (currentClaimType === 'Damages Claim') {
                        damagesDocumentsContent.style.display = 'block';
                    } else if (currentClaimType === 'Shortage Claim') {
                        shortageDocumentsContent.style.display = 'block';
                    }
                });
            }


            // Close modal if user clicks outside of it (for all modals)
            window.addEventListener('click', (event) => {
                if (event.target === customModal) {
                    hideCustomModal(customModal);
                }
                if (event.target === claimTypeModal) {
                    hideCustomModal(claimTypeModal);
                }
                if (event.target === reviewModal) {
                    hideCustomModal(reviewModal); 
                }
                if (event.target === submissionOptionsModal) { 
                    // Clicking outside submission options modal:
                    // If user wants to just close without action, assume they're done.
                    // This is a design choice. Alternatively, you could just hide the modal.
                    window.location.href = 'https://www.gerhardscanada.com'; 
                }
            });
        });
    </script>
</body>
</html>
