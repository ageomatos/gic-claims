<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GIC Damages & Shortages Claim Form</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        /* General body styles */
        body {
            font-family: 'Inter', sans-serif; /* Using Inter font as per guidelines */
            background-color: #f4f5f7; /* Light grey background */
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Align content to the top */
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box; /* Include padding in element's total width and height */
        }

        /* Main container for the form */
        .container {
            background-color: #fff; /* White background for the form */
            border-radius: 12px; /* Rounded corners for the container */
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1); /* Enhanced shadow for depth */
            width: 100%;
            max-width: 800px; /* Max width for larger screens */
            padding: 30px 40px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
        }

        /* Header styles */
        header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 1px solid #eee; /* Separator line */
            padding-bottom: 20px;
        }

        header h1 {
            font-size: 28px;
            color: #333;
            margin-bottom: 5px;
            font-weight: 700;
        }

        header .company-name {
            font-size: 16px;
            color: #666;
            margin-top: 0;
        }

        /* Progress bar styling */
        .progress-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            position: relative;
            padding: 0 20px; /* Adjust padding to give space for the first/last circles */
        }

        /* Horizontal line for the progress bar */
        .progress-bar::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 2px;
            background-color: #e0e0e0; /* Grey line */
            transform: translateY(-50%);
            z-index: 0; /* Ensure line is behind circles */
        }

        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 1; /* Ensure circles are above the line */
            color: #999; /* Default text color for steps */
            font-size: 14px;
            flex: 1; /* Distribute space evenly */
            text-align: center;
        }

        .step .circle {
            width: 34px; /* Slightly larger circles */
            height: 34px;
            border-radius: 50%;
            background-color: #e0e0e0; /* Grey circle for inactive steps */
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: 700;
            margin-bottom: 8px;
            transition: background-color 0.3s ease, color 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); /* Small shadow for circles */
        }

        /* Active step styling */
        .step.active .circle {
            background-color: #5b7da8; /* Blue color from the image */
            color: #fff;
        }

        .step.active span {
            color: #333; /* Darker text for active step */
            font-weight: 700;
        }

        /* Generic class for form sections to manage display */
        .form-section {
            display: none; /* Hidden by default */
            padding: 20px;
            border-top: 1px solid #eee;
            margin-top: 20px;
            text-align: left; /* Align text to left */
            flex-grow: 1; /* Allow section to take available vertical space */
            justify-content: space-between; /* Space out content and button */
            flex-direction: column; /* Ensure content and button are stacked */
        }

        /* Content area styling (for the initial screen) */
        .content {
            text-align: center;
            flex-grow: 1; /* Allow content to take available vertical space */
            display: flex; /* Keep as flex to manage inner layout */
            flex-direction: column;
            justify-content: space-between; /* Space out content and button */
        }

        .content p {
            font-size: 16px;
            line-height: 1.6;
            color: #555;
            margin-bottom: 20px;
        }

        .policy-link {
            color: #5b7da8; /* Blue color for the link */
            text-decoration: none;
            font-weight: 500;
            transition: color 0.2s ease;
        }

        .policy-link:hover {
            text-decoration: underline;
            color: #4a6a90; /* Slightly darker blue on hover */
        }

        /* Logo styling */
        .logo {
            margin: 40px auto; /* Center the logo and add vertical spacing */
            width: fit-content; /* Ensure the div only takes the width of the image */
        }

        .logo img {
            max-width: 250px; /* Adjust max-width as needed for your logo */
            height: auto;
            display: block; /* Remove extra space below image */
            border-radius: 8px; /* Rounded corners for the logo */
        }

        /* Button styling */
        .button-group {
            display: flex;
            justify-content: center;
            gap: 20px; /* Space between buttons */
            margin-top: 30px;
        }

        .continue-button, .next-button, .submit-button, .back-button, .copy-button {
            background-color: #5b7da8; /* Blue color from the image */
            color: #fff;
            border: none;
            padding: 14px 35px; /* Larger padding for a more prominent button */
            border-radius: 8px; /* Rounded corners for the button */
            font-size: 18px; /* Slightly larger font size */
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease, box-shadow 0.2s ease;
            font-weight: 500;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15); /* Shadow for button */
            width: auto; /* Allow button to size based on content */
            flex-shrink: 0; /* Prevent buttons from shrinking in button-group */
        }

        .back-button {
            background-color: #6c757d; /* Grey for back button */
        }

        .continue-button:hover, .next-button:hover, .submit-button:hover, .copy-button:hover {
            background-color: #4a6a90; /* Slightly darker blue on hover */
            transform: translateY(-2px); /* Slight lift effect */
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
        }

        .back-button:hover {
            background-color: #5a6268; /* Slightly darker grey on hover */
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
        }

        .continue-button:active, .next-button:active, .submit-button:active, .back-button:active, .copy-button:active {
            transform: translateY(0); /* Press down effect */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        /* Custom Modal Styles (for alert replacement) */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1000; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            width: 90%;
            max-width: 400px;
            text-align: center;
            position: relative;
            animation: fadeIn 0.3s ease-out; /* Simple fade-in animation */
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .close-button {
            color: #aaa;
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close-button:hover,
        .close-button:focus {
            color: #333;
            text-decoration: none;
        }

        #modalMessage {
            font-size: 1.1em;
            color: #333;
            margin-bottom: 25px;
        }

        #modalOkButton {
            background-color: #5b7da8;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s ease;
        }

        #modalOkButton:hover {
            background-color: #4a6a90;
        }

        /* Styles for the new Claim Type Selection Modal */
        #claimTypeModal .modal-content {
            max-width: 450px; /* Slightly wider for the options */
            padding: 40px;
        }

        #claimTypeModal h2 {
            font-size: 24px;
            color: #333;
            margin-bottom: 25px;
        }

        .claim-options {
            display: flex;
            flex-direction: column;
            gap: 15px; /* Space between radio options */
            margin-bottom: 30px;
            text-align: left; /* Align radio buttons to the left */
        }

        .claim-option {
            display: flex;
            align-items: center;
            background-color: #f0f4f7; /* Light background for options */
            padding: 15px 20px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            cursor: pointer;
            transition: background-color 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
        }

        .claim-option:hover {
            background-color: #e6edf2;
            border-color: #a7c1dd;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .claim-option input[type="radio"] {
            margin-right: 15px;
            transform: scale(1.3); /* Larger radio buttons */
            accent-color: #5b7da8; /* Blue accent color */
        }

        .claim-option label {
            font-size: 18px;
            color: #333;
            cursor: pointer;
            font-weight: 500;
        }

        .confirm-claim-button {
            background-color: #5b7da8;
            color: #fff;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 17px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease, box-shadow 0.2s ease;
            font-weight: 500;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
        }

        .confirm-claim-button:hover {
            background-color: #4a6a90;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
        }

        .confirm-claim-button:active {
            transform: translateY(0);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        /* Styles for the Damages & Shortage Terms & Conditions sections */
        #damagesTermsSection, #shortageTermsSection, #customerSection, #documentsSection, #disclaimerSection {
            text-align: left; /* Text alignment for these sections */
        }

        #damagesTermsSection h2, #shortageTermsSection h2, #customerSection h2, #documentsSection h2, #disclaimerSection h2 {
            text-align: center;
            color: #333;
            margin-bottom: 25px;
            font-size: 24px;
        }

        #damagesTermsSection ul, #shortageTermsSection ul {
            list-style: decimal; /* Numbered list */
            padding-left: 25px; /* Indent list items */
            margin-bottom: 25px;
            color: #555;
            line-height: 1.8;
        }

        #damagesTermsSection ul li, #shortageTermsSection ul li {
            margin-bottom: 10px;
        }

        #damagesTermsSection .important-note, #shortageTermsSection .important-note {
            font-weight: 500;
            color: #cc0000; /* Red color for emphasis */
            margin-top: 30px;
            text-align: center;
            line-height: 1.5;
        }

        .terms-acceptance {
            display: flex;
            align-items: center;
            justify-content: center; /* Center the checkbox and label */
            margin: 30px 0;
            font-size: 17px;
            color: #333;
        }

        .terms-acceptance input[type="checkbox"] {
            margin-right: 10px;
            transform: scale(1.4); /* Make checkbox larger */
            accent-color: #5b7da8; /* Blue accent color */
        }

        .terms-acceptance label {
            cursor: pointer;
        }

        /* Styles for Customer Section */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
            font-size: 16px;
        }

        .form-group input[type="text"],
        .form-group input[type="number"],
        .form-group input[type="file"],
        .form-group textarea { /* Added textarea */
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 16px;
            box-sizing: border-box; /* Include padding in width */
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        .form-group input[type="text"]:focus,
        .form-group input[type="number"]:focus,
        .form-group input[type="file"]:focus,
        .form-group textarea:focus { /* Added textarea */
            border-color: #5b7da8;
            box-shadow: 0 0 0 3px rgba(91, 125, 168, 0.2);
            outline: none;
        }

        .error-message {
            color: #e74c3c; /* Red color for error messages */
            font-size: 14px;
            margin-top: 5px;
            display: block; /* Ensures it takes its own line */
            text-align: left;
        }

        /* Styles for Documents Section (general) */
        /* Removed .file-upload-area specific styling as it's replaced by individual inputs */
        #documentsSection .file-input-group {
            margin-bottom: 15px; /* Space between each file input */
        }
        #documentsSection .file-input-group label {
            font-weight: normal; /* Labels for file inputs might be less bold */
            font-size: 15px;
            margin-bottom: 5px;
            color: #555;
        }


        #documentsSection .file-list {
            list-style: none;
            padding: 0;
            margin: 0;
            border: 1px solid #eee;
            border-radius: 8px;
            max-height: 200px; /* Scrollable list if many files */
            overflow-y: auto;
            margin-bottom: 20px;
        }

        #documentsSection .file-list li {
            padding: 10px 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 15px;
            color: #444;
        }

        #documentsSection .file-list li:last-child {
            border-bottom: none;
        }

        #documentsSection .file-list .remove-file {
            background: none;
            border: none;
            color: #e74c3c;
            font-size: 20px;
            cursor: pointer;
            padding: 0 5px;
            transition: color 0.2s ease;
        }

        #documentsSection .file-list .remove-file:hover {
            color: #c0392b;
        }

        /* Note at the top of the documents section */
        #documentsSection .submission-note {
            font-size: 15px;
            color: #555;
            margin-bottom: 20px;
            padding: 10px 15px;
            background-color: #eaf2fa; /* Light blue background for the note */
            border-left: 4px solid #5b7da8; /* Blue accent border */
            border-radius: 4px;
            font-weight: 500;
        }

        #documentsSection .submission-note strong {
            color: #333;
        }

        /* Specific content for Damages and Shortage documents */
        .document-content-type {
            display: none; /* Hidden by default */
            margin-top: 20px;
        }

        .document-content-type h3 {
            text-align: center;
            font-size: 20px;
            color: #444;
            margin-bottom: 20px;
        }

        /* Styles for attachment notes */
        .attachment-guidance-note { /* Renamed for clarity */
            font-size: 14px;
            color: #777;
            margin-bottom: 15px;
            text-align: center;
            line-height: 1.4;
        }
        .form-limit-note {
            font-size: 14px;
            color: #cc0000; /* Red for warning */
            text-align: center;
            margin-top: 15px;
            margin-bottom: 25px;
            font-weight: 500;
        }

        /* Styles for Disclaimer Section */
        #disclaimerSection p {
            font-size: 16px;
            line-height: 1.6;
            color: #555;
            margin-bottom: 20px;
            text-align: center;
        }

        #disclaimerSection strong {
            color: #333;
        }

        /* Styles for Review Modal */
        #reviewModal .modal-content {
            max-width: 600px;
            text-align: left;
        }

        #reviewModal h2 {
            text-align: center;
            margin-bottom: 25px;
        }

        #reviewSummaryContent {
            background-color: #f8f8f8;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #eee;
            margin-bottom: 30px;
            max-height: 400px;
            overflow-y: auto;
        }

        #reviewSummaryContent p {
            margin-bottom: 10px;
            font-size: 15px;
            color: #444;
            line-height: 1.5;
        }

        #reviewSummaryContent strong {
            color: #333;
            display: inline-block; /* Allows strong to take space */
            min-width: 150px; /* Align content if labels are short */
        }

        #reviewSummaryContent ul {
            list-style: none;
            padding: 0;
            margin-top: 5px;
            font-size: 14px;
            color: #666;
        }

        #reviewSummaryContent ul li::before {
            content: '•';
            color: #5b7da8;
            font-weight: bold;
            display: inline-block;
            width: 1em;
            margin-left: -1em;
        }

        .review-button-group {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }

        /* Styles for the final submission options modal */
        #submissionOptionsModal .modal-content {
            max-width: 450px;
            padding-top: 30px; /* Adjust padding if claim code is added */
        }
        #submissionOptionsModal .modal-content h2 {
            margin-bottom: 20px;
        }
        #submissionOptionsModal .modal-content .button-group {
            flex-direction: column;
            gap: 15px;
        }
        #submissionOptionsModal .modal-content .button-group button {
            width: 100%;
        }

        #claimCodeDisplay {
            font-size: 1.2em;
            font-weight: bold;
            color: #5b7da8;
            margin: 15px 0 25px;
            padding: 10px;
            border: 1px dashed #a7c1dd;
            border-radius: 5px;
            background-color: #eaf2fa;
            word-break: break-all; /* Ensures long codes wrap */
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .container {
                padding: 20px 25px;
            }

            header h1 {
                font-size: 24px;
            }

            .progress-bar {
                flex-wrap: wrap; /* Allow steps to wrap on smaller screens */
                justify-content: center;
                padding: 0; /* Remove padding to maximize space for wrapped steps */
                margin-bottom: 20px; /* Reduce margin for tighter layout */
            }

            .progress-bar::before {
                display: none; /* Hide the single connecting line on smaller screens */
            }

            .step {
                width: 33%; /* 3 steps per row */
                margin-bottom: 15px; /* Add margin between wrapped rows */
            }

            .step .circle {
                margin-bottom: 5px; /* Less margin for tighter spacing */
            }

            #claimTypeModal .modal-content {
                padding: 30px;
            }
            #claimTypeModal h2 {
                font-size: 20px;
            }
            .claim-option label {
                font-size: 16px;
            }

            #damagesTermsSection ul, #shortageTermsSection ul, #customerSection ul, #documentsSection ul, #disclaimerSection ul {
                padding-left: 20px;
            }
            .button-group {
                flex-direction: column;
                gap: 10px;
            }
            .continue-button, .next-button, .submit-button, .back-button, .copy-button {
                width: 100%;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }
            header h1 {
                font-size: 20px;
            }
            .step {
                width: 50%; /* 2 steps per row on very small screens */
            }
            .content p {
                font-size: 15px;
            }
            .continue-button, .next-button, .submit-button, .back-button, .copy-button {
                padding: 12px 30px;
                font-size: 16px;
            }
            #claimTypeModal .modal-content {
                padding: 20px;
            }
            .claim-option {
                padding: 12px 15px;
            }
            .claim-option label {
                font-size: 15px;
            }
            #damagesTermsSection ul, #shortageTermsSection ul, #customerSection ul, #documentsSection ul, #disclaimerSection ul {
                padding-left: 15px;
            }
             #reviewSummaryContent strong {
                min-width: 100px; /* Adjust for smaller screens */
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Damages & Shortages Claim Form</h1>
            <p class="company-name">Gerhards Importers Canada</p>
        </header>

        <nav class="progress-bar">
            <div class="step active">
                <div class="circle">1</div>
                <span>Policy</span>
            </div>
            <div class="step">
                <div class="circle">2</div>
                <span>Claim Type</span>
            </div>
            <div class="step">
                <div class="circle">3</div>
                <span>Terms/Conditions</span>
            </div>
            <div class="step">
                <div class="circle">4</div>
                <span>Customer</span>
            </div>
            <div class="step">
                <div class="circle">5</div>
                <span>Documents</span>
            </div>
            <div class="step">
                <div class="circle">6</div>
                <span>Disclaimer</span>
            </div>
        </nav>

        <form name="claim_form" method="POST" data-netlify="true" id="mainClaimForm" data-netlify-honeypot="bot-field" enctype="multipart/form-data">
            <input type="hidden" name="form-name" value="claim_form" />
            <input type="hidden" name="bot-field" />
            <input type="hidden" name="Claim Code" id="hiddenClaimCode" value="" />
            <input type="hidden" name="_subject" id="netlifySubject" value="" />

            <main id="initialContentSection" class="content form-section" style="display: block;">
                <p>At Gerhards Importers Canada, we strive to provide the best possible service to our customers, and ensuring the safe delivery of your orders is of utmost importance to us. While we make every effort to pack and ship your items securely, occasionally, damages or missing items can occur during transit.</p>
                <p>Refer to our <a href="https://gerhardscanada.sharepoint.com/:b:/s/PublicSharing/EY4yUu4ede5PoDaHoo2YleAB1C3s-Zxo3OpgSJpN8g_QyQ?e=tKFQPR" class="policy-link" id="policyLink" target="_blank">Damages and Shortages Policy here.</a></p>
                
                <div class="logo">
                    <img src="https://placehold.co/250x100/A7C1DD/FFFFFF?text=Company+Logo" alt="Gerhards Importers Canada Logo">
                </div>

                <button type="button" class="continue-button" id="continueButton">Continue</button>
            </main>

            <section id="damagesTermsSection" class="form-section">
                <h2>Terms and Conditions for Damages Claim</h2>
                <p>To ensure the full credit for your claim, the following items must be submitted.</p>
                <p>Failure to provide any of these within the specified timeframe will result in a reduced credit amount:</p>
                <ul>
                    <li>A copy of the driver's Proof of Delivery (POD), with any damages clearly noted.</li>
                    <li>Photographic or video evidence of the damages.</li>
                    <li>An accurate count of the damages per product, including brand and description.</li>
                    <li>Submission of all required documentation within 3 business days of the delivery date.</li>
                </ul>
                <p class="important-note">Please ensure all information is accurate and provided on time to avoid any reduction in credit.</p>
                
                <div class="terms-acceptance">
                    <input type="checkbox" id="acceptDamagesTerms" name="acceptDamagesTerms">
                    <label for="acceptDamagesTerms">I accept the terms and conditions for Damages Claim.</label>
                </div>
                <div class="button-group">
                    <button type="button" class="back-button" id="backButtonDamagesTerms">Back</button>
                    <button type="button" class="next-button" id="nextButtonDamagesTerms">Next</button>
                </div>
            </section>

            <section id="shortageTermsSection" class="form-section">
                <h2>Terms and Conditions for Shortage Claim</h2>
                <p>To ensure the full credit for your claim, the following items must be submitted.</p>
                <p>Failure to provide any of these within the specified timeframe will result in a reduced credit amount:</p>
                <ul>
                    <li>A copy of the driver's Proof of Delivery (POD), with any shortage clearly noted.</li>
                    <li>An accurate count of the missing per product, including brand and description.</li>
                    <li>Submission of all required documentation within 3 business days of the delivery date.</li>
                </ul>
                <p class="important-note">Please ensure all information is accurate and provided on time to avoid any reduction in credit.</p>
                
                <div class="terms-acceptance">
                    <input type="checkbox" id="acceptShortageTerms" name="acceptShortageTerms">
                    <label for="acceptShortageTerms">I accept the terms and conditions for Shortage Claim.</label>
                </div>
                <div class="button-group">
                    <button type="button" class="back-button" id="backButtonShortageTerms">Back</button>
                    <button type="button" class="next-button" id="nextButtonShortageTerms">Next</button>
                </div>
            </section>

            <section id="customerSection" class="form-section">
                <h2>Customer Information</h2>
                <div class="form-group">
                    <label for="customerName">Customer Name:</label>
                    <input type="text" id="customerName" name="Customer Name" required>
                    <span class="error-message" id="customerNameError"></span>
                </div>
                <div class="form-group">
                    <label for="packingSlipNumber">Packing Slip Number (5 digits):</label>
                    <input type="number" id="packingSlipNumber" name="Packing Slip Number" required pattern="[0-9]{5}" inputmode="numeric" maxlength="5">
                    <span class="error-message" id="packingSlipNumberError"></span>
                </div>
                <div class="button-group">
                    <button type="button" class="back-button" id="backButtonCustomer">Back</button>
                    <button type="button" class="next-button" id="nextButtonCustomer">Next</button>
                </div>
            </section>

            <section id="documentsSection" class="form-section">
                <h2>Attach Supporting Documents</h2>
                <p class="submission-note">
                    Please submit the following information <strong>within 3 business days</strong> to receive 100% credit: 
                </p>
                <p class="form-limit-note">Please note: The total size of all attachments for this form cannot exceed 8 MB.</p>

                <div id="shortageDocumentsContent" class="document-content-type">
                    <p class="attachment-guidance-note">
                        Proof of Delivery (POD) attachments are recommended.
                    </p>
                    <div class="form-group">
                        <label for="missingCountShortage">Accurate count of the missing CASES per product/brand/description:</label>
                        <textarea id="missingCountShortage" name="Missing Count (Shortage)" rows="4" required placeholder="e.g., 5 cases of Product X - Brand A, 2 cases of Product Y - Brand B"></textarea>
                        <span class="error-message" id="missingCountShortageError"></span>
                    </div>
                    <div class="file-input-group">
                        <label for="shortageFile1">Attachment 1:</label>
                        <input type="file" id="shortageFile1" name="Shortage Attachment 1" accept=".pdf,image/jpeg,image/png,image/gif,video/mp4,video/webm,video/ogg">
                    </div>
                    <div class="file-input-group">
                        <label for="shortageFile2">Attachment 2:</label>
                        <input type="file" id="shortageFile2" name="Shortage Attachment 2" accept=".pdf,image/jpeg,image/png,image/gif,video/mp4,video/webm,video/ogg">
                    </div>
                    <div class="file-input-group">
                        <label for="shortageFile3">Attachment 3:</label>
                        <input type="file" id="shortageFile3" name="Shortage Attachment 3" accept=".pdf,image/jpeg,image/png,image/gif,video/mp4,video/webm,video/ogg">
                    </div>
                    <div class="file-input-group">
                        <label for="shortageFile4">Attachment 4:</label>
                        <input type="file" id="shortageFile4" name="Shortage Attachment 4" accept=".pdf,image/jpeg,image/png,image/gif,video/mp4,video/webm,video/ogg">
                    </div>
                    <span class="error-message" id="shortageFileUploadError"></span>
                </div>

                <div id="damagesDocumentsContent" class="document-content-type">
                    <p class="attachment-guidance-note">
                        Proof of Delivery (POD) and Damages images attachments are recommended.
                    </p>
                    <div class="form-group">
                        <label for="damageCountDamages">Accurate count of the damages per product/brand/description (in units):</label>
                        <textarea id="damageCountDamages" name="Damage Count (Damages)" rows="4" required placeholder="e.g., 10 units of Product X - Brand A (broken bottles), 3 units of Product Y - Brand B (dented cans)"></textarea>
                        <span class="error-message" id="damageCountDamagesError"></span>
                    </div>
                    <div class="file-input-group">
                        <label for="damagesFile1">Attachment 1:</label>
                        <input type="file" id="damagesFile1" name="Damages Attachment 1" accept=".pdf,image/jpeg,image/png,image/gif,video/mp4,video/webm,video/ogg">
                    </div>
                    <div class="file-input-group">
                        <label for="damagesFile2">Attachment 2:</label>
                        <input type="file" id="damagesFile2" name="Damages Attachment 2" accept=".pdf,image/jpeg,image/png,image/gif,video/mp4,video/webm,video/ogg">
                    </div>
                    <div class="file-input-group">
                        <label for="damagesFile3">Attachment 3:</label>
                        <input type="file" id="damagesFile3" name="Damages Attachment 3" accept=".pdf,image/jpeg,image/png,image/gif,video/mp4,video/webm,video/ogg">
                    </div>
                    <div class="file-input-group">
                        <label for="damagesFile4">Attachment 4:</label>
                        <input type="file" id="damagesFile4" name="Damages Attachment 4" accept=".pdf,image/jpeg,image/png,image/gif,video/mp4,video/webm,video/ogg">
                    </div>
                    <span class="error-message" id="damagesFileUploadError"></span>
                </div>

                <div class="button-group">
                    <button type="button" class="back-button" id="backButtonDocuments">Back</button>
                    <button type="button" class="next-button" id="nextButtonDocuments">Next</button>
                </div>
            </section>

            <section id="disclaimerSection" class="form-section">
                <h2>Disclaimer</h2>
                <p>
                    The absence of ANY of the required supporting documentation for your claim, or if the claim was submitted AFTER the 3rd business day following the delivery date, the credited amount will be reduced accordingly.
                </p>
                <p>
                    Please ensure that all necessary documents are provided to avoid further adjustments.
                </p>
                <div class="button-group">
                    <button type="button" class="back-button" id="backButtonDisclaimer">Back</button>
                    <button type="submit" class="submit-button" id="submitButtonDisclaimer">Submit</button> 
                </div>
            </section>
        </form>


        <div id="customModal" class="modal">
            <div class="modal-content">
                <span class="close-button" id="generalModalClose">&times;</span>
                <p id="modalMessage"></p>
                <button type="button" id="modalOkButton">OK</button>
            </div>
        </div>

        <div id="claimTypeModal" class="modal">
            <div class="modal-content">
                <span class="close-button" id="claimTypeModalClose">&times;</span>
                <h2>Select Claim Type</h2>
                <div class="claim-options">
                    <label class="claim-option">
                        <input type="radio" name="claimType" value="Damages Claim" checked>
                        <span>Damages Claim</span>
                    </label>
                    <label class="claim-option">
                        <input type="radio" name="claimType" value="Shortage Claim">
                        <span>Shortage Claim</span>
                    </label>
                </div>
                <button type="button" class="confirm-claim-button" id="confirmClaimSelection">Confirm Selection</button>
            </div>
        </div>

        <div id="reviewModal" class="modal">
            <div class="modal-content">
                <span class="close-button" id="reviewModalClose">&times;</span>
                <h2>Review Your Claim Data</h2>
                <div id="reviewSummaryContent">
                    </div>
                <div class="review-button-group">
                    <button type="button" class="back-button" id="reviewModalBack">Back to edit again</button>
                    <button type="button" class="next-button" id="reviewModalSubmit">OK to finish/process</button> 
                </div>
            </div>
        </div>

        <div id="submissionOptionsModal" class="modal">
            <div class="modal-content">
                <h2>Claim Submitted Successfully!</h2>
                <p>Your Claim Code is:</p>
                <p id="claimCodeDisplay">GENERATING...</p>
                <div class="button-group">
                    <button type="button" class="copy-button" id="copyClaimCodeButton">Copy Claim Code</button>
                    <button type="button" class="next-button" id="enterAnotherClaimButton">Enter another claim</button>
                    <button type="button" class="back-button" id="closeFormButton">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const continueButton = document.getElementById('continueButton');
            const policyLink = document.getElementById('policyLink');
            
            // General custom modal elements
            const customModal = document.getElementById('customModal');
            const modalMessage = document.getElementById('modalMessage');
            const generalModalCloseButton = document.getElementById('generalModalClose');
            const modalOkButton = document.getElementById('modalOkButton');

            // Claim Type Selection Modal elements
            const claimTypeModal = document.getElementById('claimTypeModal');
            const claimTypeModalCloseButton = document.getElementById('claimTypeModalClose');
            const confirmClaimSelectionButton = document.getElementById('confirmClaimSelection');
            const claimTypeRadios = document.querySelectorAll('input[name="claimType"]'); 

            // Form sections
            const mainClaimForm = document.getElementById('mainClaimForm'); // Reference to the main form
            const initialContentSection = document.getElementById('initialContentSection');
            const damagesTermsSection = document.getElementById('damagesTermsSection');
            const shortageTermsSection = document.getElementById('shortageTermsSection');
            const customerSection = document.getElementById('customerSection');
            const documentsSection = document.getElementById('documentsSection'); 
            const disclaimerSection = document.getElementById('disclaimerSection'); 

            // Elements for Damages Terms & Conditions
            const acceptDamagesTermsCheckbox = document.getElementById('acceptDamagesTerms');
            const nextButtonDamagesTerms = document.getElementById('nextButtonDamagesTerms');
            const backButtonDamagesTerms = document.getElementById('backButtonDamagesTerms');

            // Elements for Shortage Terms & Conditions
            const acceptShortageTermsCheckbox = document.getElementById('acceptShortageTerms');
            const nextButtonShortageTerms = document.getElementById('nextButtonShortageTerms');
            const backButtonShortageTerms = document.getElementById('backButtonShortageTerms');

            // Elements for Customer Section
            const customerNameInput = document.getElementById('customerName');
            const packingSlipNumberInput = document.getElementById('packingSlipNumber');
            const customerNameError = document.getElementById('customerNameError');
            const packingSlipNumberError = document.getElementById('packingSlipNumberError');
            const nextButtonCustomer = document.getElementById('nextButtonCustomer');
            const backButtonCustomer = document.getElementById('backButtonCustomer');

            // Elements for Documents Section (conditional content)
            const shortageDocumentsContent = document.getElementById('shortageDocumentsContent');
            const damageCountDamagesInput = document.getElementById('damageCountDamages');
            const damageCountDamagesError = document.getElementById('damageCountDamagesError');

            const damagesDocumentsContent = document.getElementById('damagesDocumentsContent');
            const missingCountShortageInput = document.getElementById('missingCountShortage');
            const missingCountShortageError = document.getElementById('missingCountShortageError');

            // File input elements for Damages Claim (four distinct inputs)
            const damagesFile1Input = document.getElementById('damagesFile1');
            const damagesFile2Input = document.getElementById('damagesFile2');
            const damagesFile3Input = document.getElementById('damagesFile3');
            const damagesFile4Input = document.getElementById('damagesFile4');
            const damagesFileUploadError = document.getElementById('damagesFileUploadError'); // General error for damages files

            // File input elements for Shortage Claim (four distinct inputs)
            const shortageFile1Input = document.getElementById('shortageFile1');
            const shortageFile2Input = document.getElementById('shortageFile2');
            const shortageFile3Input = document.getElementById('shortageFile3');
            const shortageFile4Input = document.getElementById('shortageFile4');
            const shortageFileUploadError = document.getElementById('shortageFileUploadError'); // General error for shortage files

            const nextButtonDocuments = document.getElementById('nextButtonDocuments');
            const backButtonDocuments = document.getElementById('backButtonDocuments');

            // Elements for Disclaimer Section
            const backButtonDisclaimer = document.getElementById('backButtonDisclaimer');
            const submitButtonDisclaimer = document.getElementById('submitButtonDisclaimer');

            // Elements for Review Modal
            const reviewModal = document.getElementById('reviewModal');
            const reviewModalCloseButton = document.getElementById('reviewModalClose');
            const reviewSummaryContent = document.getElementById('reviewSummaryContent');
            const reviewModalBack = document.getElementById('reviewModalBack');
            const reviewModalSubmit = document.getElementById('reviewModalSubmit');

            // Elements for Submission Options Modal
            const submissionOptionsModal = document.getElementById('submissionOptionsModal');
            const claimCodeDisplay = document.getElementById('claimCodeDisplay');
            const hiddenClaimCodeInput = document.getElementById('hiddenClaimCode');
            const netlifySubjectInput = document.getElementById('netlifySubject'); // New hidden input for Netlify subject
            const copyClaimCodeButton = document.getElementById('copyClaimCodeButton'); // New copy button
            const enterAnotherClaimButton = document.getElementById('enterAnotherClaimButton');
            const closeFormButton = document.getElementById('closeFormButton');

            // Global variable to store current claim type
            let currentClaimType = ''; 
            // Global variable to store the generated claim code
            let generatedClaimCode = '';

            const progressSteps = document.querySelectorAll('.progress-bar .step');

            /**
             * Updates the active step in the progress bar.
             * @param {number} stepNumber - The 1-based index of the step to set as active.
             */
            function updateProgressBar(stepNumber) {
                progressSteps.forEach((step, index) => {
                    if (index + 1 === stepNumber) {
                        step.classList.add('active');
                    } else {
                        step.classList.remove('active');
                    }
                });
            }

            /**
             * Shows a custom modal with a given message.
             * @param {string} message - The message to display in the modal.
             * @param {HTMLElement} modalElement - The specific modal element to show (e.g., customModal or claimTypeModal).
             */
            function showCustomModal(message, modalElement) {
                if (modalElement === customModal) {
                    modalMessage.textContent = message;
                }
                modalElement.style.display = 'flex'; // Use flex to center
            }

            /**
             * Hides a specific custom modal.
             * @param {HTMLElement} modalElement - The specific modal element to hide.
             */
            function hideCustomModal(modalElement) {
                modalElement.style.display = 'none';
            }

            /**
             * Hides all content sections and modals to prepare for showing a new one.
             */
            function hideAllSectionsAndModals() {
                initialContentSection.style.display = 'none';
                damagesTermsSection.style.display = 'none';
                shortageTermsSection.style.display = 'none';
                customerSection.style.display = 'none';
                documentsSection.style.display = 'none'; 
                disclaimerSection.style.display = 'none'; 
                customModal.style.display = 'none';
                claimTypeModal.style.display = 'none';
                reviewModal.style.display = 'none'; 
                submissionOptionsModal.style.display = 'none'; 
                // Also hide specific document content divs
                shortageDocumentsContent.style.display = 'none';
                damagesDocumentsContent.style.display = 'none';
            }

            /**
             * Generates a unique claim code in the format YYYY-MM-####.
             * The sequential number is a simple increment based on a placeholder,
             * but in a real-world scenario, this should come from a backend system
             * to ensure true uniqueness and persistence.
             */
            function generateClaimCode() {
                const now = new Date();
                const year = now.getFullYear();
                const month = (now.getMonth() + 1).toString().padStart(2, '0');
                
                // For demonstration, a simple random 4-digit number.
                // In a real application, this should be fetched from a database
                // or a unique ID generator to ensure no collisions.
                const sequentialNum = Math.floor(1000 + Math.random() * 9000); 
                
                return `${year}-${month}-${sequentialNum}`;
            }

            /**
             * Resets the entire form to its initial state.
             */
            function resetForm() {
                hideAllSectionsAndModals();
                initialContentSection.style.display = 'block'; // Show initial section
                updateProgressBar(1); // Reset progress bar to Policy

                // Clear all form fields using native form.reset()
                mainClaimForm.reset(); 
                
                // Manually reset values for inputs that form.reset() might not completely clear
                damagesFile1Input.value = ''; 
                damagesFile2Input.value = ''; 
                damagesFile3Input.value = ''; 
                damagesFile4Input.value = ''; 
                shortageFile1Input.value = ''; 
                shortageFile2Input.value = ''; 
                shortageFile3Input.value = ''; 
                shortageFile4Input.value = ''; 
                hiddenClaimCodeInput.value = ''; // Clear hidden claim code
                netlifySubjectInput.value = ''; // Clear Netlify subject

                // Reset error messages
                customerNameError.textContent = '';
                packingSlipNumberError.textContent = '';
                damageCountDamagesError.textContent = '';
                missingCountShortageError.textContent = '';
                damagesFileUploadError.textContent = '';
                shortageFileUploadError.textContent = '';

                // Reset global claim type tracker
                currentClaimType = ''; 
                generatedClaimCode = ''; // Clear generated claim code

                // Ensure 'Damages Claim' radio is checked by default again if it was initially
                if (claimTypeRadios.length > 0) {
                    claimTypeRadios[0].checked = true;
                }
                console.log('Form reset to initial state.');
            }


            // Event listener for the Continue button click
            if (continueButton) {
                continueButton.addEventListener('click', () => {
                    console.log('Continue button clicked, showing claim type selection.');
                    showCustomModal('', claimTypeModal); // Show the new claim type selection modal
                });
            }

            // Event listener for the Policy link click
            if (policyLink) {
                policyLink.addEventListener('click', (event) => {
                    console.log('Policy link clicked, opening in new tab.');
                    // The link itself handles navigation with target="_blank"
                });
            }

            // Event listeners to close the general custom modal
            if (generalModalCloseButton) {
                generalModalCloseButton.addEventListener('click', () => hideCustomModal(customModal));
            }
            if (modalOkButton) {
                modalOkButton.addEventListener('click', () => hideCustomModal(customModal));
            }

            // Event listeners to close the claim type selection modal
            if (claimTypeModalCloseButton) {
                claimTypeModalCloseButton.addEventListener('click', () => hideCustomModal(claimTypeModal));
            }
            
            // Event listener for the review modal close button
            if (reviewModalCloseButton) {
                reviewModalCloseButton.addEventListener('click', () => hideCustomModal(reviewModal));
            }


            // Event listener for confirming claim type selection
            if (confirmClaimSelectionButton) {
                confirmClaimSelectionButton.addEventListener('click', () => {
                    let selectedClaimType = null;
                    for (const radio of claimTypeRadios) {
                        if (radio.checked) {
                            selectedClaimType = radio.value;
                            break;
                        }
                    }

                    if (selectedClaimType) {
                        currentClaimType = selectedClaimType; // Store selected type
                        hideCustomModal(claimTypeModal); // Hide the selection modal
                        hideAllSectionsAndModals(); // Hide all other sections

                        if (selectedClaimType === 'Damages Claim') {
                            console.log('Damages Claim selected. Showing Terms & Conditions.');
                            damagesTermsSection.style.display = 'block'; // Show damages terms section
                            updateProgressBar(3); // Update progress bar to "Terms/Conditions"
                        } else if (selectedClaimType === 'Shortage Claim') {
                            console.log('Shortage Claim selected. Showing Terms & Conditions.');
                            shortageTermsSection.style.display = 'block'; // Show shortage terms section
                            updateProgressBar(3); // Update progress bar to "Terms/Conditions"
                        }
                    } else {
                        showCustomModal('Please select a claim type to proceed.', customModal);
                    }
                });
            }

            // Event listener for the 'Next' button in Damages Terms & Conditions
            if (nextButtonDamagesTerms) {
                nextButtonDamagesTerms.addEventListener('click', () => {
                    if (acceptDamagesTermsCheckbox.checked) {
                        console.log('Damages Terms accepted. Proceeding to Customer section.');
                        hideAllSectionsAndModals(); // Hide current section
                        customerSection.style.display = 'block'; // Show customer section
                        updateProgressBar(4); // Update progress bar to "Customer"
                    } else {
                        showCustomModal('Please accept the terms and conditions to proceed.', customModal);
                    }
                });
            }

            // Event listener for the 'Next' button in Shortage Terms & Conditions
            if (nextButtonShortageTerms) {
                nextButtonShortageTerms.addEventListener('click', () => {
                    if (acceptShortageTermsCheckbox.checked) {
                        console.log('Shortage Terms accepted. Proceeding to Customer section.');
                        hideAllSectionsAndModals(); // Hide current section
                        customerSection.style.display = 'block'; // Show customer section
                        updateProgressBar(4); // Update progress bar to "Customer"
                    } else {
                        showCustomModal('Please accept the terms and conditions to proceed.', customModal);
                    }
                });
            }

            // Event listener for the 'Next' button in Customer section
            if (nextButtonCustomer) {
                nextButtonCustomer.addEventListener('click', () => {
                    let isValid = true;

                    // Validate Customer Name
                    if (customerNameInput.value.trim() === '') {
                        customerNameError.textContent = 'Customer Name is required.';
                        isValid = false;
                    } else {
                        customerNameError.textContent = '';
                    }

                    // Validate Packing Slip Number
                    const packingSlipValue = packingSlipNumberInput.value.trim();
                    if (packingSlipValue === '') {
                        packingSlipNumberError.textContent = 'Packing Slip Number is required.';
                        isValid = false;
                    } else if (!/^\d{5}$/.test(packingSlipValue)) { // Regex to check for exactly 5 digits
                        packingSlipNumberError.textContent = 'Packing Slip Number must be exactly 5 numeric digits.';
                        isValid = false;
                    } else {
                        packingSlipNumberError.textContent = '';
                    }

                    if (isValid) {
                        console.log('Customer information valid. Proceeding to Documents section.');
                        hideAllSectionsAndModals();
                        documentsSection.style.display = 'block'; // Show documents section
                        updateProgressBar(5); // Update progress bar to "Documents"
                        
                        // Show specific document content based on selected claim type
                        if (currentClaimType === 'Damages Claim') {
                            damagesDocumentsContent.style.display = 'block';
                            // No initial rendering needed for individual file inputs, Netlify handles them directly.
                        } else if (currentClaimType === 'Shortage Claim') {
                            shortageDocumentsContent.style.display = 'block';
                            // No initial rendering needed for individual file inputs, Netlify handles them directly.
                        }
                    } else {
                        showCustomModal('Please correct the errors in the customer information form.', customModal);
                    }
                });
            }

            // Add an input event listener to restrict packing slip number to 5 digits
            if (packingSlipNumberInput) {
                packingSlipNumberInput.addEventListener('input', (event) => {
                    // Get the current value
                    let value = event.target.value;
                    // Ensure it's a string and slice if longer than 5
                    if (value.length > 5) {
                        event.target.value = value.slice(0, 5);
                    }
                    // Clear error message instantly if user starts correcting
                    if (packingSlipNumberError.textContent && /^\d{5}$/.test(event.target.value)) {
                        packingSlipNumberError.textContent = '';
                    }
                });
            }

            // --- Documents Section Logic ---
            // Removed handleFileSelection, renderAttachedFiles, removeFile as they managed dynamic lists.
            // Individual file inputs now rely on browser default behavior.

            // Event listener for 'Next' button in Documents section
            if (nextButtonDocuments) {
                nextButtonDocuments.addEventListener('click', () => {
                    let isValid = true;
                    // Reset all document-related errors
                    damageCountDamagesError.textContent = '';
                    missingCountShortageError.textContent = '';
                    // No specific file input error spans (e.g., shortageFile1Error) in this version
                    // as required validation for attachments is removed.
                    shortageFileUploadError.textContent = ''; // Still clear general upload error if it was set by invalid file type
                    damagesFileUploadError.textContent = ''; // Still clear general upload error if it was set by invalid file type


                    if (currentClaimType === 'Damages Claim') {
                        // Validate 'Accurate count of damages' textbox for Damages Claim
                        if (damageCountDamagesInput.value.trim() === '') {
                            damageCountDamagesError.textContent = 'Accurate count of damages is required.';
                            isValid = false;
                        }
                        // Attachments are NOT required. No file count validation.
                    } else if (currentClaimType === 'Shortage Claim') {
                        // Validate 'Accurate count of missing CASES' textbox for Shortage Claim
                        if (missingCountShortageInput.value.trim() === '') {
                            missingCountShortageError.textContent = 'Accurate count of missing CASES is required.';
                            isValid = false;
                        }
                        // Attachments are NOT required. No file count validation.
                    }

                    if (isValid) {
                        console.log('Documents information valid. Proceeding to Disclaimer section.');
                        hideAllSectionsAndModals();
                        disclaimerSection.style.display = 'block'; // Show disclaimer section
                        updateProgressBar(6); // Update progress bar to "Disclaimer"
                    } else {
                        showCustomModal('Please fill in all required text fields in the Documents section.', customModal);
                    }
                });
            }

            // --- Disclaimer Section Logic ---
            if (submitButtonDisclaimer) {
                // This listener now correctly triggers the review modal *before* the form submission.
                submitButtonDisclaimer.addEventListener('click', (event) => {
                    event.preventDefault(); // Prevent default button behavior to show review modal first
                    console.log('Submit button clicked. Showing review modal before final submission.');
                    showReviewModal(); // Call function to show review summary
                });
            }

            /**
             * Gathers all entered data and displays it in the review modal.
             * This version retrieves file names directly from input.files.
             */
            function showReviewModal() {
                let summaryHtml = `
                    <h3>Claim Details:</h3>
                    <p><strong>Claim Type:</strong> ${currentClaimType}</p>
                    <p><strong>Customer Name:</strong> ${customerNameInput.value.trim()}</p>
                    <p><strong>Packing Slip Number:</strong> ${packingSlipNumberInput.value.trim()}</p>
                `;

                if (currentClaimType === 'Damages Claim') {
                    summaryHtml += `
                        <h3>Damages Details:</h3>
                        <p><strong>Accurate Count (Units):</strong> ${damageCountDamagesInput.value.trim()}</p>
                    `;
                    let damagesFiles = [];
                    // Collect file names from each input if files are selected
                    if (damagesFile1Input.files.length > 0) damagesFiles.push(damagesFile1Input.files[0].name);
                    if (damagesFile2Input.files.length > 0) damagesFiles.push(damagesFile2Input.files[0].name);
                    if (damagesFile3Input.files.length > 0) damagesFiles.push(damagesFile3Input.files[0].name);
                    if (damagesFile4Input.files.length > 0) damagesFiles.push(damagesFile4Input.files[0].name);

                    if (damagesFiles.length > 0) {
                        summaryHtml += `<p><strong>Attached Damages Files:</strong></p><ul>`;
                        damagesFiles.forEach(fileName => {
                            summaryHtml += `<li>${fileName}</li>`;
                        });
                        summaryHtml += `</ul>`;
                    } else {
                        summaryHtml += `<p><strong>Attached Damages Files:</strong> None</p>`;
                    }
                } else if (currentClaimType === 'Shortage Claim') {
                    summaryHtml += `
                        <h3>Shortage Details:</h3>
                        <p><strong>Accurate Count (Cases):</strong> ${missingCountShortageInput.value.trim()}</p>
                    `;
                    let shortageFiles = [];
                    // Collect file names from each input if files are selected
                    if (shortageFile1Input.files.length > 0) shortageFiles.push(shortageFile1Input.files[0].name);
                    if (shortageFile2Input.files.length > 0) shortageFiles.push(shortageFile2Input.files[0].name);
                    if (shortageFile3Input.files.length > 0) shortageFiles.push(shortageFile3Input.files[0].name);
                    if (shortageFile4Input.files.length > 0) shortageFiles.push(shortageFile4Input.files[0].name);

                    if (shortageFiles.length > 0) {
                        summaryHtml += `<p><strong>Attached Shortage Files:</strong></p><ul>`;
                        shortageFiles.forEach(fileName => {
                            summaryHtml += `<li>${fileName}</li>`;
                        });
                        summaryHtml += `</ul>`;
                    } else {
                        summaryHtml += `<p><strong>Attached Shortage Files:</strong> None</p>`;
                    }
                }

                reviewSummaryContent.innerHTML = summaryHtml;
                showCustomModal('', reviewModal); // Show the review modal
            }

            // Event listener for "OK to finish/process" in review modal
            if (reviewModalSubmit) {
                reviewModalSubmit.addEventListener('click', () => {
                    console.log('Confirmed review. Triggering form submission.');
                    // This button click now programmatically triggers the form's 'submit' event.
                    // This submit event is now handled by the async event listener directly on mainClaimForm.
                    mainClaimForm.dispatchEvent(new Event('submit', { cancelable: true }));
                });
            }

            // Event listener for "Back to edit again" in review modal
            if (reviewModalBack) {
                reviewModalBack.addEventListener('click', () => {
                    console.log('Returning to Documents section for editing.');
                    hideCustomModal(reviewModal); // Hide review modal
                    documentsSection.style.display = 'block'; // Go back to documents
                    updateProgressBar(5); // Update progress bar
                    // Re-display correct sub-section in documents
                    if (currentClaimType === 'Damages Claim') {
                        damagesDocumentsContent.style.display = 'block';
                    } else if (currentClaimType === 'Shortage Claim') {
                        shortageDocumentsContent.style.display = 'block';
                    }
                });
            }

            // --- Post-Submission Options Logic ---
            if (copyClaimCodeButton) {
                copyClaimCodeButton.addEventListener('click', () => {
                    if (generatedClaimCode) {
                        // Using document.execCommand('copy') for broader compatibility in iframes
                        const tempInput = document.createElement('textarea');
                        tempInput.value = generatedClaimCode;
                        document.body.appendChild(tempInput);
                        tempInput.select();
                        try {
                            document.execCommand('copy');
                            showCustomModal('Claim Code copied to clipboard!', customModal);
                        } catch (err) {
                            showCustomModal('Failed to copy Claim Code. Please copy it manually: ' + generatedClaimCode, customModal);
                            console.error('Failed to copy text: ', err);
                        }
                        document.body.removeChild(tempInput);
                    } else {
                        showCustomModal('No Claim Code to copy.', customModal);
                    }
                });
            }

            if (enterAnotherClaimButton) {
                enterAnotherClaimButton.addEventListener('click', () => {
                    console.log('User chose to enter another claim. Resetting form.');
                    hideCustomModal(submissionOptionsModal); // Hide the modal FIRST
                    resetForm(); // Reset the entire form
                });
            }

            if (closeFormButton) {
                closeFormButton.addEventListener('click', () => {
                    console.log('User chose to close the form. Redirecting to gerhardscanada.com');
                    hideCustomModal(submissionOptionsModal); // Hide the modal FIRST
                    window.location.href = 'https://www.gerhardscanada.com'; // Redirect to the specified URL
                });
            }


            // IMPORTANT CHANGE: Remove outside click listener for submissionOptionsModal
            // This ensures the modal stays open until a button is clicked.
            window.addEventListener('click', (event) => {
                if (event.target === customModal) {
                    hideCustomModal(customModal);
                }
                if (event.target === claimTypeModal) {
                    hideCustomModal(claimTypeModal);
                }
                if (event.target === reviewModal) {
                    hideCustomModal(reviewModal); 
                }
                // The submissionOptionsModal is now only dismissed by its internal buttons.
                // We no longer close and redirect on outside click for this specific modal.
            });
        });
    </script>
</body>
</html>
